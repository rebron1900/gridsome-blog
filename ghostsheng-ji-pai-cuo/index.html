<!DOCTYPE html>
<html data-html-server-rendered="true" lang="en" data-vue-tag="%7B%22lang%22:%7B%22ssr%22:%22en%22%7D%7D">
  <head>
    <title>只是玩玩 | JUST FUN - 只是玩玩 | JUST FUN</title><meta name="gridsome:hash" content="79ad4906a93b028ce0cc44a61d77049cbbf31c8d"><meta data-vue-tag="ssr" charset="utf-8"><meta data-vue-tag="ssr" name="generator" content="Gridsome v0.7.23"><meta data-vue-tag="ssr" data-key="viewport" name="viewport" content="width=device-width, initial-scale=1, viewport-fit=cover"><meta data-vue-tag="ssr" data-key="format-detection" name="format-detection" content="telephone=no"><meta data-vue-tag="ssr" data-key="description" name="description" content="Hello"><link data-vue-tag="ssr" rel="icon" href="data:,"><link data-vue-tag="ssr" rel="icon" type="image/png" sizes="16x16" href="/gridsome-blog/assets/static/favicon.ce0531f.9bb7ffafafc09ac851d81afb65b8ef59.png"><link data-vue-tag="ssr" rel="icon" type="image/png" sizes="32x32" href="/gridsome-blog/assets/static/favicon.ac8d93a.9bb7ffafafc09ac851d81afb65b8ef59.png"><link data-vue-tag="ssr" rel="icon" type="image/png" sizes="96x96" href="/gridsome-blog/assets/static/favicon.b9532cc.9bb7ffafafc09ac851d81afb65b8ef59.png"><link data-vue-tag="ssr" rel="apple-touch-icon" type="image/png" sizes="76x76" href="/gridsome-blog/assets/static/favicon.f22e9f3.9bb7ffafafc09ac851d81afb65b8ef59.png"><link data-vue-tag="ssr" rel="apple-touch-icon" type="image/png" sizes="152x152" href="/gridsome-blog/assets/static/favicon.62d22cb.9bb7ffafafc09ac851d81afb65b8ef59.png"><link data-vue-tag="ssr" rel="apple-touch-icon" type="image/png" sizes="120x120" href="/gridsome-blog/assets/static/favicon.1539b60.9bb7ffafafc09ac851d81afb65b8ef59.png"><link data-vue-tag="ssr" rel="apple-touch-icon" type="image/png" sizes="167x167" href="/gridsome-blog/assets/static/favicon.dc0cdc5.9bb7ffafafc09ac851d81afb65b8ef59.png"><link data-vue-tag="ssr" rel="apple-touch-icon" type="image/png" sizes="180x180" href="/gridsome-blog/assets/static/favicon.7b22250.9bb7ffafafc09ac851d81afb65b8ef59.png"><link rel="preload" href="/gridsome-blog/assets/css/0.styles.be694e5c.css" as="style"><link rel="preload" href="/gridsome-blog/assets/js/app.32f9dac0.js" as="script"><link rel="preload" href="/gridsome-blog/assets/js/page--src--templates--ghost-post-vue.0de93747.js" as="script"><link rel="prefetch" href="/gridsome-blog/assets/js/6.4b802b1d.js"><link rel="prefetch" href="/gridsome-blog/assets/js/page--node-modules--gridsome--app--pages--404-vue.5fb9a6b8.js"><link rel="prefetch" href="/gridsome-blog/assets/js/page--src--pages--index-copy-vue.caed7301.js"><link rel="prefetch" href="/gridsome-blog/assets/js/page--src--pages--index-vue.eb311bfb.js"><link rel="stylesheet" href="/gridsome-blog/assets/css/0.styles.be694e5c.css"><noscript data-vue-tag="ssr"><style>.g-image--loading{display:none;}</style></noscript>
  </head>
  <body  class="darkmode">
    <main role="main" data-server-rendered="true" id="app" class="container"><div class="row"><header class="header"><a href="/gridsome-blog/" class="active"><h1>👨‍💻 只是玩玩 | JUST FUN</h1></a><!----></header><div class="article"><h1 class="article-title">Ghost博客升级出错无法启动修复</h1><p class="article-date"> 4 October 2019 · <i> min read</i></p><article><p>由于Ghost没有自动更新系统，并保持在最新版本的功能，所以每次升级都需要用ssh登陆主机执行 <code>ghost update</code> 指令（以前后台的about里是不是有一个按钮点了就能升级？我刚刚去看好像没了）。不过好在用 <code>ghost-cli</code> 套件升级起来到是还简单方便。</p><p>今天像往常一样执行完命令，第一次执行时提示ghost-cli版本过低，不过命令还是能正常执行，但是在最后build完库之后在restart的步骤忽然卡出了，起初没在意，便放在这里忙其他的去了，忙完回来后却发现升级失败，出问题的步骤就是最后的restart的时候，报错如下：</p><figure class="kg-card kg-code-card"><pre><code class="language-shell">Debug Information:
OS: Ubuntu, v16.04
Node Version: v8.15.0
Ghost-CLI Version: 1.11.0
Environment: production
Command: 'ghost update'
Message: Could not communicate with Ghost
Suggestion: journalctl -u ghost_www-4zen-top -n 50
Stack: Error: Could not communicate with Ghost
at Server.server.close (/usr/local/lib/node_modules/ghost-cli/lib/utils/port-polling.js:56:20)
at Object.onceWrapper (events.js:313:30)
at emitNone (events.js:106:13)
at Server.emit (events.js:208:7)
at emitCloseNT (net.js:1664:8)
at _combinedTickCallback (internal/process/next_tick.js:136:11)
at process._tickCallback (internal/process/next_tick.js:181:9)

ubuntu@VM-98-64-ubuntu:/var/www/ghost$ journalctl -u ghost_www-4zen-top -n 50
-- Logs begin at Fri 2019-10-04 11:30:25 CST, end at Fri 2019-10-04 11:40:38 CST. --
Oct 04 11:34:26 VM-98-64-ubuntu systemd[1]: Stopped Ghost systemd service for blog: www-4zen-top.
Oct 04 11:34:26 VM-98-64-ubuntu systemd[1]: Started Ghost systemd service for blog: www-4zen-top.
Oct 04 11:34:27 VM-98-64-ubuntu node[3469]: /var/www/ghost/versions/2.31.1/node_modules/knex/lib/client.js:258
Oct 04 11:34:27 VM-98-64-ubuntu node[3469]: return this.acquireRawConnection().then(async (connection) =&gt; {
Oct 04 11:34:27 VM-98-64-ubuntu node[3469]: ^
Oct 04 11:34:27 VM-98-64-ubuntu node[3469]: SyntaxError: Unexpected token (
Oct 04 11:34:27 VM-98-64-ubuntu node[3469]: at createScript (vm.js:56:10)
Oct 04 11:34:27 VM-98-64-ubuntu node[3469]: at Object.runInThisContext (vm.js:97:10)
Oct 04 11:34:27 VM-98-64-ubuntu node[3469]: at Module._compile (module.js:549:28)
Oct 04 11:34:27 VM-98-64-ubuntu node[3469]: at Object.Module._extensions..js (module.js:586:10)
Oct 04 11:34:27 VM-98-64-ubuntu node[3469]: at Module.load (module.js:494:32)
Oct 04 11:34:27 VM-98-64-ubuntu node[3469]: at tryModuleLoad (module.js:453:12)
Oct 04 11:34:27 VM-98-64-ubuntu node[3469]: at Function.Module._load (module.js:445:3)
Oct 04 11:34:27 VM-98-64-ubuntu node[3469]: at Module.require (module.js:504:17)
Oct 04 11:34:27 VM-98-64-ubuntu node[3469]: at require (internal/module.js:20:19)
Oct 04 11:34:27 VM-98-64-ubuntu node[3469]: at Object. (/var/www/ghost/versions/2.31.1/node_modules/knex/lib/knex.js:2:16)
Oct 04 11:34:27 VM-98-64-ubuntu node[3469]: at Module._compile (module.js:577:32)
Oct 04 11:34:27 VM-98-64-ubuntu node[3469]: at Object.Module._extensions..js (module.js:586:10)
Oct 04 11:34:27 VM-98-64-ubuntu node[3469]: at Module.load (module.js:494:32)
Oct 04 11:34:27 VM-98-64-ubuntu node[3469]: at tryModuleLoad (module.js:453:12)
Oct 04 11:34:27 VM-98-64-ubuntu node[3469]: at Function.Module._load (module.js:445:3)
Oct 04 11:34:27 VM-98-64-ubuntu node[3469]: at Module.require (module.js:504:17)</code></pre><figcaption>报错信息&nbsp;</figcaption></figure><p>之后我用run命令单独执行ghost后程序正常运行，看来程序已经正常升级，只是systemd保持进程时出了问题。</p><p>自己研究了一阵后无果，便想着去github上 发条issue，看有没有人能帮到我——很可惜，等了半小时都没有答复。</p><figure class="kg-card kg-bookmark-card"><a class="kg-bookmark-container" href="https://github.com/TryGhost/Ghost/issues/11199?ref=1900.live"><div class="kg-bookmark-content"><div class="kg-bookmark-title">Restart after the upgrade is complete · Issue #11199 · TryGhost/Ghost</div><div class="kg-bookmark-description">Debug Information: OS: Ubuntu, v16.04 Node Version: v8.15.0 Ghost-CLI Version: 1.11.0 Environment: production Command: &amp;#39;ghost update&amp;#39; Message: Could not communicate with Ghost Suggestion: j...</div><div class="kg-bookmark-metadata"><img class="kg-bookmark-icon" src="https://github.githubassets.com/favicon.ico" alt><span class="kg-bookmark-author">GitHub</span><span class="kg-bookmark-publisher">TryGhost</span></div></div><div class="kg-bookmark-thumbnail"><img src="https://avatars3.githubusercontent.com/u/2178663?s&#x3D;400&amp;v&#x3D;4" alt></div></a></figure><p>无奈之下自己尝试了一下</p><ol><li>在ghost目录下有个system文件夹，里面存放有systemd的配置文件，</li><li>把这个出错的配置文件更名</li><li>执行 <code>ghost steup systemd</code> 重新建立systemd配置文件</li><li>执行 <code>ghost restart</code> 指令运行程序</li><li>修复成功</li></ol><p>虽然大概知道是配置文件的问题，但是不清楚具体因为什么原因而出错，升级过程中除了ghost-cli的版本过低警告外就是npm的版本更新提示，没出现过其他错误。</p><p>觉得很莫名其妙...。 </p></article></div><div class="footer"><div><p>
          Built with
          <a target="_blank" href="//gridsome.org" class="link">Gridsome</a>
          &amp; Made with ❤️ by
          <a target="_blank" href="//alex.design" class="link">Alex Brown</a></p></div><div class="footer-links"><a target="_blank" href="/sitemap.xml">Sitemap</a><a target="_blank" href="/feed.xml">RSS Feed</a></div></div></div></main>
    <script>window.__INITIAL_STATE__={"data":{"metadata":{"siteName":"只是玩玩 | JUST FUN","siteDescription":"Hello"},"post":{"id":"63158312cf533d1c2cf29b15","title":"Ghost博客升级出错无法启动修复","content":"\u003Cp\u003E由于Ghost没有自动更新系统，并保持在最新版本的功能，所以每次升级都需要用ssh登陆主机执行 \u003Ccode\u003Eghost update\u003C\u002Fcode\u003E 指令（以前后台的about里是不是有一个按钮点了就能升级？我刚刚去看好像没了）。不过好在用 \u003Ccode\u003Eghost-cli\u003C\u002Fcode\u003E 套件升级起来到是还简单方便。\u003C\u002Fp\u003E\u003Cp\u003E今天像往常一样执行完命令，第一次执行时提示ghost-cli版本过低，不过命令还是能正常执行，但是在最后build完库之后在restart的步骤忽然卡出了，起初没在意，便放在这里忙其他的去了，忙完回来后却发现升级失败，出问题的步骤就是最后的restart的时候，报错如下：\u003C\u002Fp\u003E\u003Cfigure class=\"kg-card kg-code-card\"\u003E\u003Cpre\u003E\u003Ccode class=\"language-shell\"\u003EDebug Information:\nOS: Ubuntu, v16.04\nNode Version: v8.15.0\nGhost-CLI Version: 1.11.0\nEnvironment: production\nCommand: 'ghost update'\nMessage: Could not communicate with Ghost\nSuggestion: journalctl -u ghost_www-4zen-top -n 50\nStack: Error: Could not communicate with Ghost\nat Server.server.close (\u002Fusr\u002Flocal\u002Flib\u002Fnode_modules\u002Fghost-cli\u002Flib\u002Futils\u002Fport-polling.js:56:20)\nat Object.onceWrapper (events.js:313:30)\nat emitNone (events.js:106:13)\nat Server.emit (events.js:208:7)\nat emitCloseNT (net.js:1664:8)\nat _combinedTickCallback (internal\u002Fprocess\u002Fnext_tick.js:136:11)\nat process._tickCallback (internal\u002Fprocess\u002Fnext_tick.js:181:9)\n\nubuntu@VM-98-64-ubuntu:\u002Fvar\u002Fwww\u002Fghost$ journalctl -u ghost_www-4zen-top -n 50\n-- Logs begin at Fri 2019-10-04 11:30:25 CST, end at Fri 2019-10-04 11:40:38 CST. --\nOct 04 11:34:26 VM-98-64-ubuntu systemd[1]: Stopped Ghost systemd service for blog: www-4zen-top.\nOct 04 11:34:26 VM-98-64-ubuntu systemd[1]: Started Ghost systemd service for blog: www-4zen-top.\nOct 04 11:34:27 VM-98-64-ubuntu node[3469]: \u002Fvar\u002Fwww\u002Fghost\u002Fversions\u002F2.31.1\u002Fnode_modules\u002Fknex\u002Flib\u002Fclient.js:258\nOct 04 11:34:27 VM-98-64-ubuntu node[3469]: return this.acquireRawConnection().then(async (connection) =&gt; {\nOct 04 11:34:27 VM-98-64-ubuntu node[3469]: ^\nOct 04 11:34:27 VM-98-64-ubuntu node[3469]: SyntaxError: Unexpected token (\nOct 04 11:34:27 VM-98-64-ubuntu node[3469]: at createScript (vm.js:56:10)\nOct 04 11:34:27 VM-98-64-ubuntu node[3469]: at Object.runInThisContext (vm.js:97:10)\nOct 04 11:34:27 VM-98-64-ubuntu node[3469]: at Module._compile (module.js:549:28)\nOct 04 11:34:27 VM-98-64-ubuntu node[3469]: at Object.Module._extensions..js (module.js:586:10)\nOct 04 11:34:27 VM-98-64-ubuntu node[3469]: at Module.load (module.js:494:32)\nOct 04 11:34:27 VM-98-64-ubuntu node[3469]: at tryModuleLoad (module.js:453:12)\nOct 04 11:34:27 VM-98-64-ubuntu node[3469]: at Function.Module._load (module.js:445:3)\nOct 04 11:34:27 VM-98-64-ubuntu node[3469]: at Module.require (module.js:504:17)\nOct 04 11:34:27 VM-98-64-ubuntu node[3469]: at require (internal\u002Fmodule.js:20:19)\nOct 04 11:34:27 VM-98-64-ubuntu node[3469]: at Object. (\u002Fvar\u002Fwww\u002Fghost\u002Fversions\u002F2.31.1\u002Fnode_modules\u002Fknex\u002Flib\u002Fknex.js:2:16)\nOct 04 11:34:27 VM-98-64-ubuntu node[3469]: at Module._compile (module.js:577:32)\nOct 04 11:34:27 VM-98-64-ubuntu node[3469]: at Object.Module._extensions..js (module.js:586:10)\nOct 04 11:34:27 VM-98-64-ubuntu node[3469]: at Module.load (module.js:494:32)\nOct 04 11:34:27 VM-98-64-ubuntu node[3469]: at tryModuleLoad (module.js:453:12)\nOct 04 11:34:27 VM-98-64-ubuntu node[3469]: at Function.Module._load (module.js:445:3)\nOct 04 11:34:27 VM-98-64-ubuntu node[3469]: at Module.require (module.js:504:17)\u003C\u002Fcode\u003E\u003C\u002Fpre\u003E\u003Cfigcaption\u003E报错信息&nbsp;\u003C\u002Ffigcaption\u003E\u003C\u002Ffigure\u003E\u003Cp\u003E之后我用run命令单独执行ghost后程序正常运行，看来程序已经正常升级，只是systemd保持进程时出了问题。\u003C\u002Fp\u003E\u003Cp\u003E自己研究了一阵后无果，便想着去github上 发条issue，看有没有人能帮到我——很可惜，等了半小时都没有答复。\u003C\u002Fp\u003E\u003Cfigure class=\"kg-card kg-bookmark-card\"\u003E\u003Ca class=\"kg-bookmark-container\" href=\"https:\u002F\u002Fgithub.com\u002FTryGhost\u002FGhost\u002Fissues\u002F11199?ref=1900.live\"\u003E\u003Cdiv class=\"kg-bookmark-content\"\u003E\u003Cdiv class=\"kg-bookmark-title\"\u003ERestart after the upgrade is complete · Issue #11199 · TryGhost\u002FGhost\u003C\u002Fdiv\u003E\u003Cdiv class=\"kg-bookmark-description\"\u003EDebug Information: OS: Ubuntu, v16.04 Node Version: v8.15.0 Ghost-CLI Version: 1.11.0 Environment: production Command: &amp;#39;ghost update&amp;#39; Message: Could not communicate with Ghost Suggestion: j...\u003C\u002Fdiv\u003E\u003Cdiv class=\"kg-bookmark-metadata\"\u003E\u003Cimg class=\"kg-bookmark-icon\" src=\"https:\u002F\u002Fgithub.githubassets.com\u002Ffavicon.ico\" alt\u003E\u003Cspan class=\"kg-bookmark-author\"\u003EGitHub\u003C\u002Fspan\u003E\u003Cspan class=\"kg-bookmark-publisher\"\u003ETryGhost\u003C\u002Fspan\u003E\u003C\u002Fdiv\u003E\u003C\u002Fdiv\u003E\u003Cdiv class=\"kg-bookmark-thumbnail\"\u003E\u003Cimg src=\"https:\u002F\u002Favatars3.githubusercontent.com\u002Fu\u002F2178663?s&#x3D;400&amp;v&#x3D;4\" alt\u003E\u003C\u002Fdiv\u003E\u003C\u002Fa\u003E\u003C\u002Ffigure\u003E\u003Cp\u003E无奈之下自己尝试了一下\u003C\u002Fp\u003E\u003Col\u003E\u003Cli\u003E在ghost目录下有个system文件夹，里面存放有systemd的配置文件，\u003C\u002Fli\u003E\u003Cli\u003E把这个出错的配置文件更名\u003C\u002Fli\u003E\u003Cli\u003E执行 \u003Ccode\u003Eghost steup systemd\u003C\u002Fcode\u003E 重新建立systemd配置文件\u003C\u002Fli\u003E\u003Cli\u003E执行 \u003Ccode\u003Eghost restart\u003C\u002Fcode\u003E 指令运行程序\u003C\u002Fli\u003E\u003Cli\u003E修复成功\u003C\u002Fli\u003E\u003C\u002Fol\u003E\u003Cp\u003E虽然大概知道是配置文件的问题，但是不清楚具体因为什么原因而出错，升级过程中除了ghost-cli的版本过低警告外就是npm的版本更新提示，没出现过其他错误。\u003C\u002Fp\u003E\u003Cp\u003E觉得很莫名其妙...。 \u003C\u002Fp\u003E","date":"4 October 2019","path":"ghostsheng-ji-pai-cuo"}},"context":{}};(function(){var s;(s=document.currentScript||document.scripts[document.scripts.length-1]).parentNode.removeChild(s);}());</script><script src="/gridsome-blog/assets/js/app.32f9dac0.js" defer></script><script src="/gridsome-blog/assets/js/page--src--templates--ghost-post-vue.0de93747.js" defer></script>
  </body>
</html>