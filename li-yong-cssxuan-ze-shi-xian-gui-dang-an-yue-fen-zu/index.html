<!DOCTYPE html>
<html data-html-server-rendered="true" lang="en" data-vue-tag="%7B%22lang%22:%7B%22ssr%22:%22en%22%7D%7D">
  <head>
    <title>只是玩玩 | JUST FUN - 只是玩玩 | JUST FUN</title><meta name="gridsome:hash" content="c29e28eb09cebfa4d5785bfac51829c54a26be66"><meta data-vue-tag="ssr" charset="utf-8"><meta data-vue-tag="ssr" name="generator" content="Gridsome v0.7.23"><meta data-vue-tag="ssr" data-key="viewport" name="viewport" content="width=device-width, initial-scale=1, viewport-fit=cover"><meta data-vue-tag="ssr" data-key="format-detection" name="format-detection" content="telephone=no"><meta data-vue-tag="ssr" data-key="description" name="description" content="Hello"><link data-vue-tag="ssr" rel="icon" href="data:,"><link data-vue-tag="ssr" rel="icon" type="image/png" sizes="16x16" href="/gridsome-blog/assets/static/favicon.ce0531f.9bb7ffafafc09ac851d81afb65b8ef59.png"><link data-vue-tag="ssr" rel="icon" type="image/png" sizes="32x32" href="/gridsome-blog/assets/static/favicon.ac8d93a.9bb7ffafafc09ac851d81afb65b8ef59.png"><link data-vue-tag="ssr" rel="icon" type="image/png" sizes="96x96" href="/gridsome-blog/assets/static/favicon.b9532cc.9bb7ffafafc09ac851d81afb65b8ef59.png"><link data-vue-tag="ssr" rel="apple-touch-icon" type="image/png" sizes="76x76" href="/gridsome-blog/assets/static/favicon.f22e9f3.9bb7ffafafc09ac851d81afb65b8ef59.png"><link data-vue-tag="ssr" rel="apple-touch-icon" type="image/png" sizes="152x152" href="/gridsome-blog/assets/static/favicon.62d22cb.9bb7ffafafc09ac851d81afb65b8ef59.png"><link data-vue-tag="ssr" rel="apple-touch-icon" type="image/png" sizes="120x120" href="/gridsome-blog/assets/static/favicon.1539b60.9bb7ffafafc09ac851d81afb65b8ef59.png"><link data-vue-tag="ssr" rel="apple-touch-icon" type="image/png" sizes="167x167" href="/gridsome-blog/assets/static/favicon.dc0cdc5.9bb7ffafafc09ac851d81afb65b8ef59.png"><link data-vue-tag="ssr" rel="apple-touch-icon" type="image/png" sizes="180x180" href="/gridsome-blog/assets/static/favicon.7b22250.9bb7ffafafc09ac851d81afb65b8ef59.png"><link rel="preload" href="/gridsome-blog/assets/css/0.styles.be694e5c.css" as="style"><link rel="preload" href="/gridsome-blog/assets/js/app.f85ec778.js" as="script"><link rel="preload" href="/gridsome-blog/assets/js/page--src--templates--ghost-post-vue.a078e51b.js" as="script"><link rel="prefetch" href="/gridsome-blog/assets/js/5.fd828304.js"><link rel="prefetch" href="/gridsome-blog/assets/js/page--node-modules--gridsome--app--pages--404-vue.5fb9a6b8.js"><link rel="prefetch" href="/gridsome-blog/assets/js/page--src--pages--index-vue.fba0d161.js"><link rel="stylesheet" href="/gridsome-blog/assets/css/0.styles.be694e5c.css"><noscript data-vue-tag="ssr"><style>.g-image--loading{display:none;}</style></noscript>
  </head>
  <body  class="darkmode">
    <main role="main" data-server-rendered="true" id="app" class="container"><div class="row"><header class="header"><a href="/gridsome-blog/" class="active"><h1>👨‍💻 只是玩玩 | JUST FUN</h1></a><!----></header><div class="article"><h1 class="article-title">Ghost利用CSS选择器实现归档按月分组</h1><p class="article-date"> 21 July 2022 · <i> min read</i></p><article><h3 id="javascript%E6%96%B9%E6%A1%88">JavaScript方案</h3><p>关于Ghost如何实现文章归档页面我之前有在关于页面的<a href="https://1900.live/about/#blogs">BLogs</a>部分有提到过如何用JavaScript脚本来实现。</p><pre><code class="language-html">2016 年 &amp; 丙申年 12 月 18 日
优化了文章归档页的实现，之前 xknow 写的 js 感觉略微繁琐，这次改用之前发现的 jquery 选择器，用 [year="2015"] 这种选择器语法直接获得当前年份的所有文章数，7 行代码就搞定了，之后完善下细节，增加年份月份折叠等功能把。

    var currentYear = "";
    $("#hidden-temp-container ul li").each(function(i){
        var year = $(this).find("em").attr("year");
        if(year &lt; currentYear || currentYear == ""){
            currentYear = year;
            $(this).before("&lt;h3 class='"+currentYear+"'&gt;"+currentYear+"&lt;/h3&gt;&lt;em&gt;(" + $("[year='"+ currentYear +"']").length +"篇文章)&lt;/em&gt;");
        }

    });
    
站点更新 12 月 18 日</code></pre><hr><h3 id="%E6%9C%89%E6%B2%A1%E6%9C%89%E5%85%B6%E4%BB%96%E9%80%89%E6%8B%A9%EF%BC%9F">有没有其他选择？</h3><p>我前些日子研究douban数据展示的时候在<a href="https://immmmm.com/movies/?ref=1900.live">immmm</a> 的博客里看到了Hugo这个静态博客生成器是通过<a href="https://github.com/lmm214/immmmm/blob/master/themes/hello-friend/layouts/archives/list.html?ref=1900.live">类似Groupby的方式</a>通过时间来分组获得数据，我就想着Ghost有没有这个功能呢？</p><figure class="kg-card kg-code-card"><pre><code class="language-html">{{- range  (where (where .Site.Pages "Type" "in" "posts") "Kind" "page").GroupByDate "2006" }}
    &lt;div class="post archive__group-posts "&gt;
        {{- range .Pages.GroupByDate "2006-01" }}
        &lt;div class="archive__group-month"&gt;
          &lt;h3&gt;{{ .Key }}&lt;/h3&gt;
          &lt;div class="archive__post"&gt;
          {{- range .Pages }}
          &lt;div class="archive__post-title"&gt;
            &lt;a href="{{.Permalink}}"&gt;{{.Title}}&lt;span class="post-date"&gt;{{ .Date.Format ($.Site.Params.DateFormatList | default "2006-01-02") }}&lt;/span&gt;&lt;/a&gt;
          &lt;/div&gt;
          {{ end }}
          &lt;/div&gt;
        &lt;/div&gt;
        {{- end }}
    &lt;/div&gt;
    {{- end }}</code></pre><figcaption>hugo的方式</figcaption></figure><h3 id="%E5%90%8E%E7%AB%AF%E6%96%B9%E6%A1%88%E5%B0%9D%E8%AF%95">后端方案尝试</h3><p>Ghost使用的是<a href="https://handlebarsjs.com/zh/guide/?ref=1900.live">handlebars</a> 作为主题模板的，可惜我找遍了文档也没有这方面的资料，而且官方提供的<a href="https://ghost.org/docs/themes/helpers/?ref=1900.live#functional-helpers">Functional helpers</a> 里并没有相关可以用的组件，所以从服务器端处理的方法肯定就行不通了。</p><p>虽然你可以用get的filter属性来做一些复杂查询，但是无法实现Groupby这种功能</p><figure class="kg-card kg-code-card"><pre><code>{{! Only get posts that are featured }}
{{#get "posts" limit="all" filter="featured:true"}}
    {{#foreach posts}}
        &lt;a href="{{slug}}"&gt;{{title}}&lt;/a&gt;
    {{/foreach}}
{{/get}}</code></pre><figcaption>get助手的filter工具</figcaption></figure><p>如果不通过JavaScript、后端的的方式来处理就只能使用CSS了，但是要怎么写可把我难坏了，第一天晚上冥思苦想了很久不知道怎么下手，一晚上也没想出个什么好的办法。</p><h3 id="css%E6%96%B9%E6%A1%88">CSS方案</h3><p>而且Baidu、Google都没有找到合适的解决方案，无奈之下就去Ghost的官方论坛看看有没有其他人对这个方案提过建议。</p><p>运气不错的我很快就找到了一个帖子讨论过归档页的问题，看来广大用户对这个东西还是很有共鸣的，有<a href="https://forum.ghost.org/t/monthly-archive-index-pages/12110/2?ref=1900.live">大佬直接丢了一个Demo</a>结构</p><blockquote>You’re in luck <a href="https://forum.ghost.org/u/pts?ref=1900.live"><strong>@pts</strong></a>, we’ve got something just for that. The post loop looks like this: </blockquote><figure class="kg-card kg-code-card"><pre><code class="language-html">{{#foreach posts}}
  &lt;article class="post post-date-{{date format="M"}}"&gt;
    &lt;div class="post-label"&gt;{{date format="MMMM YYYY"}}&lt;/div&gt;
    &lt;a class="post-link" href="{{url}}"&gt;
      &lt;h2 class="post-title"&gt;{{title}}&lt;/h2&gt;
    &lt;/a&gt;
  &lt;/article&gt;
{{/foreach}}</code></pre><figcaption>模板页面</figcaption></figure><blockquote>This renders each post with the date above it in the format of Month and year, e.g. January 2020. They key part is the <code>&lt;article&gt;</code> element has a class which includes the post month as a single digit number, e.g. <code>post-date-1</code> for January. We can then hook into that class using some CSS:</blockquote><figure class="kg-card kg-code-card"><pre><code class="language-css">.post-date-1 + .post-date-1 .post-label,
.post-date-2 + .post-date-2 .post-label,
.post-date-3 + .post-date-3 .post-label,
.post-date-4 + .post-date-4 .post-label,
.post-date-5 + .post-date-5 .post-label,
.post-date-6 + .post-date-6 .post-label,
.post-date-7 + .post-date-7 .post-label,
.post-date-8 + .post-date-8 .post-label,
.post-date-9 + .post-date-9 .post-label,
.post-date-10 + .post-date-10 .post-label,
.post-date-11 + .post-date-11 .post-label,
.post-date-12 + .post-date-12 .post-label {
  display: none;
}</code></pre><figcaption>css样式</figcaption></figure><blockquote>This CSS will pick out any post which immediately follows a post with a matching <code>post-date-X</code> class. The result is exactly as desired and meets accessibility expectations. Even works with pagination.<br>Hope this helps!</blockquote><p>我查了一下 <code>.class + .class</code> 这种语法的文档说明：</p><blockquote>element+element div + p 选择紧跟 &lt;div&gt; 元素的首个 &lt;p&gt; 元素。</blockquote><p>这就好理解了现在的归档列表结构是这样的，红框部分为月份，我们只需要通过 <code>.class + .class</code>  这个选择器获取第一个元素之后的同名元素进行隐藏即可只保留第一个月份元素。</p><figure class="kg-card kg-image-card"><img src="https://cdn.1900.live/202207/snipaste_2022-07-21_10-44-21.jpg" class="kg-image" alt loading="lazy" width="580" height="429"></figure><p>有了这个再给结构写一些样式就能只通过CSS实现现在这种效果拉。</p><figure class="kg-card kg-image-card"><img src="https://cdn.1900.live/202207/snipaste_2022-07-21_10-46-45.jpg" class="kg-image" alt loading="lazy" width="717" height="829"></figure></article></div><div class="footer"><div><p>
          Built with
          <a target="_blank" href="//gridsome.org" class="link">Gridsome</a>
          &amp; Made with ❤️ by
          <a target="_blank" href="//alex.design" class="link">Alex Brown</a></p></div><div class="footer-links"><a target="_blank" href="/sitemap.xml">Sitemap</a><a target="_blank" href="/feed.xml">RSS Feed</a></div></div></div></main>
    <script>window.__INITIAL_STATE__={"data":{"metadata":{"siteName":"只是玩玩 | JUST FUN","siteDescription":"Hello"},"post":{"id":"63158312cf533d1c2cf29b87","title":"Ghost利用CSS选择器实现归档按月分组","content":"\u003Ch3 id=\"javascript%E6%96%B9%E6%A1%88\"\u003EJavaScript方案\u003C\u002Fh3\u003E\u003Cp\u003E关于Ghost如何实现文章归档页面我之前有在关于页面的\u003Ca href=\"https:\u002F\u002F1900.live\u002Fabout\u002F#blogs\"\u003EBLogs\u003C\u002Fa\u003E部分有提到过如何用JavaScript脚本来实现。\u003C\u002Fp\u003E\u003Cpre\u003E\u003Ccode class=\"language-html\"\u003E2016 年 &amp; 丙申年 12 月 18 日\n优化了文章归档页的实现，之前 xknow 写的 js 感觉略微繁琐，这次改用之前发现的 jquery 选择器，用 [year=\"2015\"] 这种选择器语法直接获得当前年份的所有文章数，7 行代码就搞定了，之后完善下细节，增加年份月份折叠等功能把。\n\n    var currentYear = \"\";\n    $(\"#hidden-temp-container ul li\").each(function(i){\n        var year = $(this).find(\"em\").attr(\"year\");\n        if(year &lt; currentYear || currentYear == \"\"){\n            currentYear = year;\n            $(this).before(\"&lt;h3 class='\"+currentYear+\"'&gt;\"+currentYear+\"&lt;\u002Fh3&gt;&lt;em&gt;(\" + $(\"[year='\"+ currentYear +\"']\").length +\"篇文章)&lt;\u002Fem&gt;\");\n        }\n\n    });\n    \n站点更新 12 月 18 日\u003C\u002Fcode\u003E\u003C\u002Fpre\u003E\u003Chr\u003E\u003Ch3 id=\"%E6%9C%89%E6%B2%A1%E6%9C%89%E5%85%B6%E4%BB%96%E9%80%89%E6%8B%A9%EF%BC%9F\"\u003E有没有其他选择？\u003C\u002Fh3\u003E\u003Cp\u003E我前些日子研究douban数据展示的时候在\u003Ca href=\"https:\u002F\u002Fimmmmm.com\u002Fmovies\u002F?ref=1900.live\"\u003Eimmmm\u003C\u002Fa\u003E 的博客里看到了Hugo这个静态博客生成器是通过\u003Ca href=\"https:\u002F\u002Fgithub.com\u002Flmm214\u002Fimmmmm\u002Fblob\u002Fmaster\u002Fthemes\u002Fhello-friend\u002Flayouts\u002Farchives\u002Flist.html?ref=1900.live\"\u003E类似Groupby的方式\u003C\u002Fa\u003E通过时间来分组获得数据，我就想着Ghost有没有这个功能呢？\u003C\u002Fp\u003E\u003Cfigure class=\"kg-card kg-code-card\"\u003E\u003Cpre\u003E\u003Ccode class=\"language-html\"\u003E{{- range  (where (where .Site.Pages \"Type\" \"in\" \"posts\") \"Kind\" \"page\").GroupByDate \"2006\" }}\n    &lt;div class=\"post archive__group-posts \"&gt;\n        {{- range .Pages.GroupByDate \"2006-01\" }}\n        &lt;div class=\"archive__group-month\"&gt;\n          &lt;h3&gt;{{ .Key }}&lt;\u002Fh3&gt;\n          &lt;div class=\"archive__post\"&gt;\n          {{- range .Pages }}\n          &lt;div class=\"archive__post-title\"&gt;\n            &lt;a href=\"{{.Permalink}}\"&gt;{{.Title}}&lt;span class=\"post-date\"&gt;{{ .Date.Format ($.Site.Params.DateFormatList | default \"2006-01-02\") }}&lt;\u002Fspan&gt;&lt;\u002Fa&gt;\n          &lt;\u002Fdiv&gt;\n          {{ end }}\n          &lt;\u002Fdiv&gt;\n        &lt;\u002Fdiv&gt;\n        {{- end }}\n    &lt;\u002Fdiv&gt;\n    {{- end }}\u003C\u002Fcode\u003E\u003C\u002Fpre\u003E\u003Cfigcaption\u003Ehugo的方式\u003C\u002Ffigcaption\u003E\u003C\u002Ffigure\u003E\u003Ch3 id=\"%E5%90%8E%E7%AB%AF%E6%96%B9%E6%A1%88%E5%B0%9D%E8%AF%95\"\u003E后端方案尝试\u003C\u002Fh3\u003E\u003Cp\u003EGhost使用的是\u003Ca href=\"https:\u002F\u002Fhandlebarsjs.com\u002Fzh\u002Fguide\u002F?ref=1900.live\"\u003Ehandlebars\u003C\u002Fa\u003E 作为主题模板的，可惜我找遍了文档也没有这方面的资料，而且官方提供的\u003Ca href=\"https:\u002F\u002Fghost.org\u002Fdocs\u002Fthemes\u002Fhelpers\u002F?ref=1900.live#functional-helpers\"\u003EFunctional helpers\u003C\u002Fa\u003E 里并没有相关可以用的组件，所以从服务器端处理的方法肯定就行不通了。\u003C\u002Fp\u003E\u003Cp\u003E虽然你可以用get的filter属性来做一些复杂查询，但是无法实现Groupby这种功能\u003C\u002Fp\u003E\u003Cfigure class=\"kg-card kg-code-card\"\u003E\u003Cpre\u003E\u003Ccode\u003E{{! Only get posts that are featured }}\n{{#get \"posts\" limit=\"all\" filter=\"featured:true\"}}\n    {{#foreach posts}}\n        &lt;a href=\"{{slug}}\"&gt;{{title}}&lt;\u002Fa&gt;\n    {{\u002Fforeach}}\n{{\u002Fget}}\u003C\u002Fcode\u003E\u003C\u002Fpre\u003E\u003Cfigcaption\u003Eget助手的filter工具\u003C\u002Ffigcaption\u003E\u003C\u002Ffigure\u003E\u003Cp\u003E如果不通过JavaScript、后端的的方式来处理就只能使用CSS了，但是要怎么写可把我难坏了，第一天晚上冥思苦想了很久不知道怎么下手，一晚上也没想出个什么好的办法。\u003C\u002Fp\u003E\u003Ch3 id=\"css%E6%96%B9%E6%A1%88\"\u003ECSS方案\u003C\u002Fh3\u003E\u003Cp\u003E而且Baidu、Google都没有找到合适的解决方案，无奈之下就去Ghost的官方论坛看看有没有其他人对这个方案提过建议。\u003C\u002Fp\u003E\u003Cp\u003E运气不错的我很快就找到了一个帖子讨论过归档页的问题，看来广大用户对这个东西还是很有共鸣的，有\u003Ca href=\"https:\u002F\u002Fforum.ghost.org\u002Ft\u002Fmonthly-archive-index-pages\u002F12110\u002F2?ref=1900.live\"\u003E大佬直接丢了一个Demo\u003C\u002Fa\u003E结构\u003C\u002Fp\u003E\u003Cblockquote\u003EYou’re in luck \u003Ca href=\"https:\u002F\u002Fforum.ghost.org\u002Fu\u002Fpts?ref=1900.live\"\u003E\u003Cstrong\u003E@pts\u003C\u002Fstrong\u003E\u003C\u002Fa\u003E, we’ve got something just for that. The post loop looks like this: \u003C\u002Fblockquote\u003E\u003Cfigure class=\"kg-card kg-code-card\"\u003E\u003Cpre\u003E\u003Ccode class=\"language-html\"\u003E{{#foreach posts}}\n  &lt;article class=\"post post-date-{{date format=\"M\"}}\"&gt;\n    &lt;div class=\"post-label\"&gt;{{date format=\"MMMM YYYY\"}}&lt;\u002Fdiv&gt;\n    &lt;a class=\"post-link\" href=\"{{url}}\"&gt;\n      &lt;h2 class=\"post-title\"&gt;{{title}}&lt;\u002Fh2&gt;\n    &lt;\u002Fa&gt;\n  &lt;\u002Farticle&gt;\n{{\u002Fforeach}}\u003C\u002Fcode\u003E\u003C\u002Fpre\u003E\u003Cfigcaption\u003E模板页面\u003C\u002Ffigcaption\u003E\u003C\u002Ffigure\u003E\u003Cblockquote\u003EThis renders each post with the date above it in the format of Month and year, e.g. January 2020. They key part is the \u003Ccode\u003E&lt;article&gt;\u003C\u002Fcode\u003E element has a class which includes the post month as a single digit number, e.g. \u003Ccode\u003Epost-date-1\u003C\u002Fcode\u003E for January. We can then hook into that class using some CSS:\u003C\u002Fblockquote\u003E\u003Cfigure class=\"kg-card kg-code-card\"\u003E\u003Cpre\u003E\u003Ccode class=\"language-css\"\u003E.post-date-1 + .post-date-1 .post-label,\n.post-date-2 + .post-date-2 .post-label,\n.post-date-3 + .post-date-3 .post-label,\n.post-date-4 + .post-date-4 .post-label,\n.post-date-5 + .post-date-5 .post-label,\n.post-date-6 + .post-date-6 .post-label,\n.post-date-7 + .post-date-7 .post-label,\n.post-date-8 + .post-date-8 .post-label,\n.post-date-9 + .post-date-9 .post-label,\n.post-date-10 + .post-date-10 .post-label,\n.post-date-11 + .post-date-11 .post-label,\n.post-date-12 + .post-date-12 .post-label {\n  display: none;\n}\u003C\u002Fcode\u003E\u003C\u002Fpre\u003E\u003Cfigcaption\u003Ecss样式\u003C\u002Ffigcaption\u003E\u003C\u002Ffigure\u003E\u003Cblockquote\u003EThis CSS will pick out any post which immediately follows a post with a matching \u003Ccode\u003Epost-date-X\u003C\u002Fcode\u003E class. The result is exactly as desired and meets accessibility expectations. Even works with pagination.\u003Cbr\u003EHope this helps!\u003C\u002Fblockquote\u003E\u003Cp\u003E我查了一下 \u003Ccode\u003E.class + .class\u003C\u002Fcode\u003E 这种语法的文档说明：\u003C\u002Fp\u003E\u003Cblockquote\u003Eelement+element div + p 选择紧跟 &lt;div&gt; 元素的首个 &lt;p&gt; 元素。\u003C\u002Fblockquote\u003E\u003Cp\u003E这就好理解了现在的归档列表结构是这样的，红框部分为月份，我们只需要通过 \u003Ccode\u003E.class + .class\u003C\u002Fcode\u003E  这个选择器获取第一个元素之后的同名元素进行隐藏即可只保留第一个月份元素。\u003C\u002Fp\u003E\u003Cfigure class=\"kg-card kg-image-card\"\u003E\u003Cimg src=\"https:\u002F\u002Fcdn.1900.live\u002F202207\u002Fsnipaste_2022-07-21_10-44-21.jpg\" class=\"kg-image\" alt loading=\"lazy\" width=\"580\" height=\"429\"\u003E\u003C\u002Ffigure\u003E\u003Cp\u003E有了这个再给结构写一些样式就能只通过CSS实现现在这种效果拉。\u003C\u002Fp\u003E\u003Cfigure class=\"kg-card kg-image-card\"\u003E\u003Cimg src=\"https:\u002F\u002Fcdn.1900.live\u002F202207\u002Fsnipaste_2022-07-21_10-46-45.jpg\" class=\"kg-image\" alt loading=\"lazy\" width=\"717\" height=\"829\"\u003E\u003C\u002Ffigure\u003E","date":"21 July 2022","path":"li-yong-cssxuan-ze-shi-xian-gui-dang-an-yue-fen-zu"}},"context":{}};(function(){var s;(s=document.currentScript||document.scripts[document.scripts.length-1]).parentNode.removeChild(s);}());</script><script src="/gridsome-blog/assets/js/app.f85ec778.js" defer></script><script src="/gridsome-blog/assets/js/page--src--templates--ghost-post-vue.a078e51b.js" defer></script>
  </body>
</html>