<!DOCTYPE html>
<html data-html-server-rendered="true" lang="en" data-vue-tag="%7B%22lang%22:%7B%22ssr%22:%22en%22%7D%7D">
  <head>
    <title>只是玩玩 | JUST FUN - 只是玩玩 | JUST FUN</title><meta name="gridsome:hash" content="03d4e26bc6a7202eb1f57b68d71e0c4979a9960b"><meta data-vue-tag="ssr" charset="utf-8"><meta data-vue-tag="ssr" name="generator" content="Gridsome v0.7.23"><meta data-vue-tag="ssr" data-key="viewport" name="viewport" content="width=device-width, initial-scale=1, viewport-fit=cover"><meta data-vue-tag="ssr" data-key="format-detection" name="format-detection" content="telephone=no"><meta data-vue-tag="ssr" data-key="description" name="description" content="/gridsome-blog"><link data-vue-tag="ssr" rel="icon" href="data:,"><link data-vue-tag="ssr" rel="icon" type="image/png" sizes="16x16" href="/assets/static/favicon.ce0531f.9bb7ffafafc09ac851d81afb65b8ef59.png"><link data-vue-tag="ssr" rel="icon" type="image/png" sizes="32x32" href="/assets/static/favicon.ac8d93a.9bb7ffafafc09ac851d81afb65b8ef59.png"><link data-vue-tag="ssr" rel="icon" type="image/png" sizes="96x96" href="/assets/static/favicon.b9532cc.9bb7ffafafc09ac851d81afb65b8ef59.png"><link data-vue-tag="ssr" rel="apple-touch-icon" type="image/png" sizes="76x76" href="/assets/static/favicon.f22e9f3.9bb7ffafafc09ac851d81afb65b8ef59.png"><link data-vue-tag="ssr" rel="apple-touch-icon" type="image/png" sizes="152x152" href="/assets/static/favicon.62d22cb.9bb7ffafafc09ac851d81afb65b8ef59.png"><link data-vue-tag="ssr" rel="apple-touch-icon" type="image/png" sizes="120x120" href="/assets/static/favicon.1539b60.9bb7ffafafc09ac851d81afb65b8ef59.png"><link data-vue-tag="ssr" rel="apple-touch-icon" type="image/png" sizes="167x167" href="/assets/static/favicon.dc0cdc5.9bb7ffafafc09ac851d81afb65b8ef59.png"><link data-vue-tag="ssr" rel="apple-touch-icon" type="image/png" sizes="180x180" href="/assets/static/favicon.7b22250.9bb7ffafafc09ac851d81afb65b8ef59.png"><link rel="preload" href="/assets/css/0.styles.be694e5c.css" as="style"><link rel="preload" href="/assets/js/app.86bb94d9.js" as="script"><link rel="preload" href="/assets/js/page--src--templates--ghost-post-vue.0de93747.js" as="script"><link rel="prefetch" href="/assets/js/6.4b802b1d.js"><link rel="prefetch" href="/assets/js/page--node-modules--gridsome--app--pages--404-vue.5fb9a6b8.js"><link rel="prefetch" href="/assets/js/page--src--pages--index-copy-vue.caed7301.js"><link rel="prefetch" href="/assets/js/page--src--pages--index-vue.a2bb3d29.js"><link rel="stylesheet" href="/assets/css/0.styles.be694e5c.css"><noscript data-vue-tag="ssr"><style>.g-image--loading{display:none;}</style></noscript>
  </head>
  <body  class="darkmode">
    <main role="main" data-server-rendered="true" id="app" class="container"><div class="row"><header class="header"><a href="/" class="active"><h1>👨‍💻 只是玩玩 | JUST FUN</h1></a><!----></header><div class="article"><h1 class="article-title">Ubuntu开启Swap缓解死机问题</h1><p class="article-date"> 19 June 2023 · <i> min read</i></p><article><p>之前有提到过我的腾讯轻量云小鸡 <a href="https://1900.live/the-server-often-crashes-inexplicably-and-has-sequelae/">频繁爆内存卡死</a> 的情况，之前也想过一些办法处理，比如：停掉一些不用的服务、检查了是不是docker更新容器太多卡等等。不过都没有解决这个问题。</p><p>前几天找其他资料时偶然看到了一个添加Swap缓存文件的命令，所以我想是不是腾讯轻量云在安装Ubuntu的时候不会自动开启Swap功能呢？</p><p>在SSH中输入 <code>top</code> ，然后按一下 <code>m</code> 键就能查看内存的占用情况。</p><p>果然，Swap部分显示 <code>0/0</code> ，没有Swap文件（截图是开启后的样子）。之后我通过相关的资料开启了Swap后运行了一个多星期，以前爆内存卡死的情况已经没有发生，实测有效。</p><p>和我一样有内存不够死机情况的朋友们或者想优化服务器性能的朋友都可以试试看。</p><figure class="kg-card kg-image-card kg-card-hascaption"><img src="https://cdn.1900.live/assets/2023/06/19image.png" class="kg-image" alt loading="lazy" width="862" height="604"><figcaption>top命令显示系统各项占用情况</figcaption></figure><h3 id="swap%E6%98%AF%E4%BB%80%E4%B9%88">Swap是什么</h3><blockquote class="kg-blockquote-alt">Swap分区（也称交换分区）是硬盘上的一个区域，被指定为操作系统可以临时存储数据的地方，这些数据不能再保存在RAM中。 基本上，这使您能够增加服务器在工作“内存”中保留的信息量，但有一些注意事项，主要是当RAM中没有足够的空间容纳正在使用的应用程序数据时，将使用硬盘驱动器上的交换空间。</blockquote><p>其实在Windows中也有这个功能，早期XP时代玩电脑优化的朋友应该都设置过，不过以前折腾Windows的时候感觉设置这个的作用微乎其微。</p><figure class="kg-card kg-image-card"><img src="https://cdn.1900.live/assets/2023/06/19Snipaste_2023-06-19_11-57-06.jpg" class="kg-image" alt loading="lazy" width="641" height="752"></figure><h3 id="ubuntu%E5%A6%82%E4%BD%95%E5%BC%80%E5%90%AFswap">Ubuntu如何开启Swap</h3><p>具体命令如下</p><pre><code class="language-bash">#创建一个空文件，具体大小的话对于小内存机器建议为内存的两倍 (例子中 1K * 4M = 4 GiB).
sudo mkdir -v /var/cache/swap
cd /var/cache/swap
sudo dd if=/dev/zero of=swapfile bs=1K count=4M
sudo chmod 600 swapfile

#将新建的文件转换为 swap 文件.
sudo mkswap swapfile

#开启 swap.

sudo swapon swapfile

#通过 swapon 或者 top 命令进行验证:
swapon -s
#或者
top -bn1 | grep -i swap
#会显示类似信息: KiB Swap: 4194300 total, 4194300 free

#禁用 swap 时可以使用 sudo swapoff swapfile.

#将该分区设置成开机加载.
echo "/var/cache/swap/swapfile none swap sw 0 0" | sudo tee -a /etc/fstab

#测试开机加载:
sudo swapoff swapfile
sudo swapon -va</code></pre><figure class="kg-card kg-bookmark-card"><a class="kg-bookmark-container" href="https://cloud.tencent.com/developer/article/1720884?ref=1900.live"><div class="kg-bookmark-content"><div class="kg-bookmark-title">Ubuntu添加swap分区的方法-腾讯云开发者社区-腾讯云</div><div class="kg-bookmark-description">前段时间上车了腾讯云 360 买三年多的学生机的活动，加上降配总共获得 6 年，然而内存降到 1G 后，跑个 mysql 时间长了内存都不够。而且腾讯云的 ubuntu 不知道什么原因 1G 内存实际只有 800+M，更加雪上加霜。</div><div class="kg-bookmark-metadata"><img class="kg-bookmark-icon" src="https://cloud.tencent.com/favicon.ico" alt></div></div></a></figure><p>End</p></article></div><div class="footer"><div><p>
          Built with
          <a target="_blank" href="//gridsome.org" class="link">Gridsome</a>
          &amp; Made with ❤️ by
          <a target="_blank" href="//alex.design" class="link">Alex Brown</a></p></div><div class="footer-links"><a target="_blank" href="/sitemap.xml">Sitemap</a><a target="_blank" href="/feed.xml">RSS Feed</a></div></div></div></main>
    <script>window.__INITIAL_STATE__={"data":{"metadata":{"siteName":"只是玩玩 | JUST FUN","siteDescription":"\u002Fgridsome-blog"},"post":{"id":"648fcd559f158c00014cfff3","title":"Ubuntu开启Swap缓解死机问题","content":"\u003Cp\u003E之前有提到过我的腾讯轻量云小鸡 \u003Ca href=\"https:\u002F\u002F1900.live\u002Fthe-server-often-crashes-inexplicably-and-has-sequelae\u002F\"\u003E频繁爆内存卡死\u003C\u002Fa\u003E 的情况，之前也想过一些办法处理，比如：停掉一些不用的服务、检查了是不是docker更新容器太多卡等等。不过都没有解决这个问题。\u003C\u002Fp\u003E\u003Cp\u003E前几天找其他资料时偶然看到了一个添加Swap缓存文件的命令，所以我想是不是腾讯轻量云在安装Ubuntu的时候不会自动开启Swap功能呢？\u003C\u002Fp\u003E\u003Cp\u003E在SSH中输入 \u003Ccode\u003Etop\u003C\u002Fcode\u003E ，然后按一下 \u003Ccode\u003Em\u003C\u002Fcode\u003E 键就能查看内存的占用情况。\u003C\u002Fp\u003E\u003Cp\u003E果然，Swap部分显示 \u003Ccode\u003E0\u002F0\u003C\u002Fcode\u003E ，没有Swap文件（截图是开启后的样子）。之后我通过相关的资料开启了Swap后运行了一个多星期，以前爆内存卡死的情况已经没有发生，实测有效。\u003C\u002Fp\u003E\u003Cp\u003E和我一样有内存不够死机情况的朋友们或者想优化服务器性能的朋友都可以试试看。\u003C\u002Fp\u003E\u003Cfigure class=\"kg-card kg-image-card kg-card-hascaption\"\u003E\u003Cimg src=\"https:\u002F\u002Fcdn.1900.live\u002Fassets\u002F2023\u002F06\u002F19image.png\" class=\"kg-image\" alt loading=\"lazy\" width=\"862\" height=\"604\"\u003E\u003Cfigcaption\u003Etop命令显示系统各项占用情况\u003C\u002Ffigcaption\u003E\u003C\u002Ffigure\u003E\u003Ch3 id=\"swap%E6%98%AF%E4%BB%80%E4%B9%88\"\u003ESwap是什么\u003C\u002Fh3\u003E\u003Cblockquote class=\"kg-blockquote-alt\"\u003ESwap分区（也称交换分区）是硬盘上的一个区域，被指定为操作系统可以临时存储数据的地方，这些数据不能再保存在RAM中。 基本上，这使您能够增加服务器在工作“内存”中保留的信息量，但有一些注意事项，主要是当RAM中没有足够的空间容纳正在使用的应用程序数据时，将使用硬盘驱动器上的交换空间。\u003C\u002Fblockquote\u003E\u003Cp\u003E其实在Windows中也有这个功能，早期XP时代玩电脑优化的朋友应该都设置过，不过以前折腾Windows的时候感觉设置这个的作用微乎其微。\u003C\u002Fp\u003E\u003Cfigure class=\"kg-card kg-image-card\"\u003E\u003Cimg src=\"https:\u002F\u002Fcdn.1900.live\u002Fassets\u002F2023\u002F06\u002F19Snipaste_2023-06-19_11-57-06.jpg\" class=\"kg-image\" alt loading=\"lazy\" width=\"641\" height=\"752\"\u003E\u003C\u002Ffigure\u003E\u003Ch3 id=\"ubuntu%E5%A6%82%E4%BD%95%E5%BC%80%E5%90%AFswap\"\u003EUbuntu如何开启Swap\u003C\u002Fh3\u003E\u003Cp\u003E具体命令如下\u003C\u002Fp\u003E\u003Cpre\u003E\u003Ccode class=\"language-bash\"\u003E#创建一个空文件，具体大小的话对于小内存机器建议为内存的两倍 (例子中 1K * 4M = 4 GiB).\nsudo mkdir -v \u002Fvar\u002Fcache\u002Fswap\ncd \u002Fvar\u002Fcache\u002Fswap\nsudo dd if=\u002Fdev\u002Fzero of=swapfile bs=1K count=4M\nsudo chmod 600 swapfile\n\n#将新建的文件转换为 swap 文件.\nsudo mkswap swapfile\n\n#开启 swap.\n\nsudo swapon swapfile\n\n#通过 swapon 或者 top 命令进行验证:\nswapon -s\n#或者\ntop -bn1 | grep -i swap\n#会显示类似信息: KiB Swap: 4194300 total, 4194300 free\n\n#禁用 swap 时可以使用 sudo swapoff swapfile.\n\n#将该分区设置成开机加载.\necho \"\u002Fvar\u002Fcache\u002Fswap\u002Fswapfile none swap sw 0 0\" | sudo tee -a \u002Fetc\u002Ffstab\n\n#测试开机加载:\nsudo swapoff swapfile\nsudo swapon -va\u003C\u002Fcode\u003E\u003C\u002Fpre\u003E\u003Cfigure class=\"kg-card kg-bookmark-card\"\u003E\u003Ca class=\"kg-bookmark-container\" href=\"https:\u002F\u002Fcloud.tencent.com\u002Fdeveloper\u002Farticle\u002F1720884?ref=1900.live\"\u003E\u003Cdiv class=\"kg-bookmark-content\"\u003E\u003Cdiv class=\"kg-bookmark-title\"\u003EUbuntu添加swap分区的方法-腾讯云开发者社区-腾讯云\u003C\u002Fdiv\u003E\u003Cdiv class=\"kg-bookmark-description\"\u003E前段时间上车了腾讯云 360 买三年多的学生机的活动，加上降配总共获得 6 年，然而内存降到 1G 后，跑个 mysql 时间长了内存都不够。而且腾讯云的 ubuntu 不知道什么原因 1G 内存实际只有 800+M，更加雪上加霜。\u003C\u002Fdiv\u003E\u003Cdiv class=\"kg-bookmark-metadata\"\u003E\u003Cimg class=\"kg-bookmark-icon\" src=\"https:\u002F\u002Fcloud.tencent.com\u002Ffavicon.ico\" alt\u003E\u003C\u002Fdiv\u003E\u003C\u002Fdiv\u003E\u003C\u002Fa\u003E\u003C\u002Ffigure\u003E\u003Cp\u003EEnd\u003C\u002Fp\u003E","date":"19 June 2023","path":"kai-qi-swaphuan-jie-si-ji-wen-ti"}},"context":{}};(function(){var s;(s=document.currentScript||document.scripts[document.scripts.length-1]).parentNode.removeChild(s);}());</script><script src="/assets/js/app.86bb94d9.js" defer></script><script src="/assets/js/page--src--templates--ghost-post-vue.0de93747.js" defer></script>
  </body>
</html>