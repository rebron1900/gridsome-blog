{"hash":"c172d95f3caedc458b15c41bd34a3ceddae884e7","data":{"metadata":{"siteName":"只是玩玩 | JUST FUN","siteDescription":"/gridsome-blog"},"post":{"id":"63158312cf533d1c2cf29b87","title":"Ghost利用CSS选择器实现归档按月分组","content":"<h3 id=\"javascript%E6%96%B9%E6%A1%88\">JavaScript方案</h3><p>关于Ghost如何实现文章归档页面我之前有在关于页面的<a href=\"https://1900.live/about/#blogs\">BLogs</a>部分有提到过如何用JavaScript脚本来实现。</p><pre><code class=\"language-html\">2016 年 &amp; 丙申年 12 月 18 日\n优化了文章归档页的实现，之前 xknow 写的 js 感觉略微繁琐，这次改用之前发现的 jquery 选择器，用 [year=\"2015\"] 这种选择器语法直接获得当前年份的所有文章数，7 行代码就搞定了，之后完善下细节，增加年份月份折叠等功能把。\n\n    var currentYear = \"\";\n    $(\"#hidden-temp-container ul li\").each(function(i){\n        var year = $(this).find(\"em\").attr(\"year\");\n        if(year &lt; currentYear || currentYear == \"\"){\n            currentYear = year;\n            $(this).before(\"&lt;h3 class='\"+currentYear+\"'&gt;\"+currentYear+\"&lt;/h3&gt;&lt;em&gt;(\" + $(\"[year='\"+ currentYear +\"']\").length +\"篇文章)&lt;/em&gt;\");\n        }\n\n    });\n    \n站点更新 12 月 18 日</code></pre><hr><h3 id=\"%E6%9C%89%E6%B2%A1%E6%9C%89%E5%85%B6%E4%BB%96%E9%80%89%E6%8B%A9%EF%BC%9F\">有没有其他选择？</h3><p>我前些日子研究douban数据展示的时候在<a href=\"https://immmmm.com/movies/?ref=1900.live\">immmm</a> 的博客里看到了Hugo这个静态博客生成器是通过<a href=\"https://github.com/lmm214/immmmm/blob/master/themes/hello-friend/layouts/archives/list.html?ref=1900.live\">类似Groupby的方式</a>通过时间来分组获得数据，我就想着Ghost有没有这个功能呢？</p><figure class=\"kg-card kg-code-card\"><pre><code class=\"language-html\">{{- range  (where (where .Site.Pages \"Type\" \"in\" \"posts\") \"Kind\" \"page\").GroupByDate \"2006\" }}\n    &lt;div class=\"post archive__group-posts \"&gt;\n        {{- range .Pages.GroupByDate \"2006-01\" }}\n        &lt;div class=\"archive__group-month\"&gt;\n          &lt;h3&gt;{{ .Key }}&lt;/h3&gt;\n          &lt;div class=\"archive__post\"&gt;\n          {{- range .Pages }}\n          &lt;div class=\"archive__post-title\"&gt;\n            &lt;a href=\"{{.Permalink}}\"&gt;{{.Title}}&lt;span class=\"post-date\"&gt;{{ .Date.Format ($.Site.Params.DateFormatList | default \"2006-01-02\") }}&lt;/span&gt;&lt;/a&gt;\n          &lt;/div&gt;\n          {{ end }}\n          &lt;/div&gt;\n        &lt;/div&gt;\n        {{- end }}\n    &lt;/div&gt;\n    {{- end }}</code></pre><figcaption>hugo的方式</figcaption></figure><h3 id=\"%E5%90%8E%E7%AB%AF%E6%96%B9%E6%A1%88%E5%B0%9D%E8%AF%95\">后端方案尝试</h3><p>Ghost使用的是<a href=\"https://handlebarsjs.com/zh/guide/?ref=1900.live\">handlebars</a> 作为主题模板的，可惜我找遍了文档也没有这方面的资料，而且官方提供的<a href=\"https://ghost.org/docs/themes/helpers/?ref=1900.live#functional-helpers\">Functional helpers</a> 里并没有相关可以用的组件，所以从服务器端处理的方法肯定就行不通了。</p><p>虽然你可以用get的filter属性来做一些复杂查询，但是无法实现Groupby这种功能</p><figure class=\"kg-card kg-code-card\"><pre><code>{{! Only get posts that are featured }}\n{{#get \"posts\" limit=\"all\" filter=\"featured:true\"}}\n    {{#foreach posts}}\n        &lt;a href=\"{{slug}}\"&gt;{{title}}&lt;/a&gt;\n    {{/foreach}}\n{{/get}}</code></pre><figcaption>get助手的filter工具</figcaption></figure><p>如果不通过JavaScript、后端的的方式来处理就只能使用CSS了，但是要怎么写可把我难坏了，第一天晚上冥思苦想了很久不知道怎么下手，一晚上也没想出个什么好的办法。</p><h3 id=\"css%E6%96%B9%E6%A1%88\">CSS方案</h3><p>而且Baidu、Google都没有找到合适的解决方案，无奈之下就去Ghost的官方论坛看看有没有其他人对这个方案提过建议。</p><p>运气不错的我很快就找到了一个帖子讨论过归档页的问题，看来广大用户对这个东西还是很有共鸣的，有<a href=\"https://forum.ghost.org/t/monthly-archive-index-pages/12110/2?ref=1900.live\">大佬直接丢了一个Demo</a>结构</p><blockquote>You’re in luck <a href=\"https://forum.ghost.org/u/pts?ref=1900.live\"><strong>@pts</strong></a>, we’ve got something just for that. The post loop looks like this: </blockquote><figure class=\"kg-card kg-code-card\"><pre><code class=\"language-html\">{{#foreach posts}}\n  &lt;article class=\"post post-date-{{date format=\"M\"}}\"&gt;\n    &lt;div class=\"post-label\"&gt;{{date format=\"MMMM YYYY\"}}&lt;/div&gt;\n    &lt;a class=\"post-link\" href=\"{{url}}\"&gt;\n      &lt;h2 class=\"post-title\"&gt;{{title}}&lt;/h2&gt;\n    &lt;/a&gt;\n  &lt;/article&gt;\n{{/foreach}}</code></pre><figcaption>模板页面</figcaption></figure><blockquote>This renders each post with the date above it in the format of Month and year, e.g. January 2020. They key part is the <code>&lt;article&gt;</code> element has a class which includes the post month as a single digit number, e.g. <code>post-date-1</code> for January. We can then hook into that class using some CSS:</blockquote><figure class=\"kg-card kg-code-card\"><pre><code class=\"language-css\">.post-date-1 + .post-date-1 .post-label,\n.post-date-2 + .post-date-2 .post-label,\n.post-date-3 + .post-date-3 .post-label,\n.post-date-4 + .post-date-4 .post-label,\n.post-date-5 + .post-date-5 .post-label,\n.post-date-6 + .post-date-6 .post-label,\n.post-date-7 + .post-date-7 .post-label,\n.post-date-8 + .post-date-8 .post-label,\n.post-date-9 + .post-date-9 .post-label,\n.post-date-10 + .post-date-10 .post-label,\n.post-date-11 + .post-date-11 .post-label,\n.post-date-12 + .post-date-12 .post-label {\n  display: none;\n}</code></pre><figcaption>css样式</figcaption></figure><blockquote>This CSS will pick out any post which immediately follows a post with a matching <code>post-date-X</code> class. The result is exactly as desired and meets accessibility expectations. Even works with pagination.<br>Hope this helps!</blockquote><p>我查了一下 <code>.class + .class</code> 这种语法的文档说明：</p><blockquote>element+element div + p 选择紧跟 &lt;div&gt; 元素的首个 &lt;p&gt; 元素。</blockquote><p>这就好理解了现在的归档列表结构是这样的，红框部分为月份，我们只需要通过 <code>.class + .class</code>  这个选择器获取第一个元素之后的同名元素进行隐藏即可只保留第一个月份元素。</p><figure class=\"kg-card kg-image-card\"><img src=\"https://cdn.1900.live/202207/snipaste_2022-07-21_10-44-21.jpg\" class=\"kg-image\" alt loading=\"lazy\" width=\"580\" height=\"429\"></figure><p>有了这个再给结构写一些样式就能只通过CSS实现现在这种效果拉。</p><figure class=\"kg-card kg-image-card\"><img src=\"https://cdn.1900.live/202207/snipaste_2022-07-21_10-46-45.jpg\" class=\"kg-image\" alt loading=\"lazy\" width=\"717\" height=\"829\"></figure>","date":"21 July 2022","path":"li-yong-cssxuan-ze-shi-xian-gui-dang-an-yue-fen-zu"}},"context":{}}