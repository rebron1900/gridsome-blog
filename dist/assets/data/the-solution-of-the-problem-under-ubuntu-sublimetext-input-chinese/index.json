{"hash":"c172d95f3caedc458b15c41bd34a3ceddae884e7","data":{"metadata":{"siteName":"只是玩玩 | JUST FUN","siteDescription":"/gridsome-blog"},"post":{"id":"63158312cf533d1c2cf29a64","title":"Ubuntu下SublimeText输入中文问题的解决","content":"<!--kg-card-begin: markdown--><p>关于Pyhton的编码工具我选来选出还是觉得SublimeText这款工具简单好用，Vim配置太过复杂了，我折腾了一天就放弃了，SublimeText的中文输入有一点问题，所以要写一个C的将文字传送给SublimeText～～（貌似是这样，我也是个菜鸟，这个C文件的作用我也不是太懂，我说错了的话看到这篇文章的大大给我解释一下吧- -），下面具体说下安装方式把。</p>\n<blockquote>\n<p>中文输入的问题是参考的这篇文章：<a href=\"http://blog.csdn.net/jokes000/article/details/8997587?ref=1900.live\">http://blog.csdn.net/jokes000/article/details/8997587</a></p>\n</blockquote>\n<p>我是直接在SublimeText的官网上下的压缩文件，解压后文件夹内的SublimeText2程序是可以直接运行的，但是这个时候是无法输入中文的。</p>\n<p>首先因为要用编译C文件，所以我们要下载相应的C工具包，在shell里输入下面的命令即可：</p>\n<p>1sudoapt-get installbuild-essential2sudoapt-get installlibgtk2.0-dev</p>\n<p>然后将下面这段代码保存成sublime-imfix.c文件</p>\n<blockquote>\n<h1 id=\"includegtkgtkhincludegdkgdkxh\">include &lt;gtk/gtk.h&gt;#include &lt;gdk/gdkx.h&gt;</h1>\n<p>typedef GdkSegment GdkRegionBox;</p>\n<p>struct _GdkRegion</p>\n<p>{</p>\n<p>long size;</p>\n<p>long numRects;</p>\n<p>GdkRegionBox *rects;</p>\n<p>GdkRegionBox extents;</p>\n<p>};</p>\n<p>GtkIMContext *local_context;</p>\n<p>voidgdk_region_get_clipbox (const GdkRegion *region , GdkRectangle *rectangle)</p>\n<p>{</p>\n<p>g_return_if_fail (region != NULL);</p>\n<p>g_return_if_fail (rectangle != NULL);</p>\n<p>rectangle-&gt;x = region-&gt;extents.x1;</p>\n<p>rectangle-&gt;y = region-&gt;extents.y1;</p>\n<p>rectangle-&gt;width = region-&gt;extents.x2 – region-&gt;extents.x1;</p>\n<p>rectangle-&gt;height = region-&gt;extents.y2 – region-&gt;extents.y1;</p>\n<p>GdkRectangle rect;</p>\n<p>rect.x = rectangle-&gt;x;</p>\n<p>rect.y = rectangle-&gt;y;</p>\n<p>rect.width = 0;</p>\n<p>rect.height = rectangle-&gt;height;</p>\n<p>if(rectangle-&gt;width == 2 &amp;&amp; GTK_IS_IM_CONTEXT(local_context)) {</p>\n<p>gtk_im_context_set_cursor_location(local_context, rectangle);</p>\n<p>}</p>\n<p>}</p>\n<p>static GdkFilterReturn event_filter (GdkXEvent *xevent, GdkEvent *event, gpointer im_context)</p>\n<p>{</p>\n<p>XEvent *xev = (XEvent *)xevent;</p>\n<p>if(xev-&gt;type == KeyRelease &amp;&amp; GTK_IS_IM_CONTEXT(im_context)) {</p>\n<p>GdkWindow * win = g_object_get_data(G_OBJECT(im_context),&quot;window&quot;);</p>\n<p>if(GDK_IS_WINDOW(win))</p>\n<p>gtk_im_context_set_client_window(im_context, win);</p>\n<p>}</p>\n<p>return GDK_FILTER_CONTINUE;</p>\n<p>}</p>\n<p>void gtk_im_context_set_client_window (GtkIMContext *context , GdkWindow *window)</p>\n<p>{</p>\n<p>GtkIMContextClass *klass;</p>\n<p>g_return_if_fail (GTK_IS_IM_CONTEXT (context));</p>\n<p>klass = GTK_IM_CONTEXT_GET_CLASS (context);</p>\n<p>if (klass-&gt;set_client_window)</p>\n<p>klass-&gt;set_client_window (context, window);</p>\n<p>if(!GDK_IS_WINDOW (window))</p>\n<p>return;</p>\n<p>g_object_set_data(G_OBJECT(context),&quot;window&quot;,window);</p>\n<p>int width = gdk_window_get_width(window);</p>\n<p>int height = gdk_window_get_height(window);</p>\n<p>if(width != 0 &amp;&amp; height !=0) {</p>\n<p>gtk_im_context_focus_in(context);</p>\n<p>local_context = context;</p>\n<p>}</p>\n<p>gdk_window_add_filter (window, event_filter, context);</p>\n<p>}</p>\n<p></p>\n</blockquote>\n<p>然后用cd命令进入你存放C文件的地方，运行下面这条命令编译文件（这行命令要一次性运行）</p>\n<blockquote>\n<p>1gcc -shared -o libsublime-imfix.so sublime_imfix.c  <code>pkg-config –libs –cflags gtk+-2.0</code> -fPIC</p>\n</blockquote>\n<p>运行后如果没有大的问题你会发现目录下出现了一个.so文件，把这个文件用mv命令移动到SublimeText的目录下面，然后用shell进入SublimeText目录后运行下面这个脚本就可以打开SublimeText输入中文了。（我的SublimeText放在Home目录下的APP文件夹下面，这里你们要改成你们自己的路径）</p>\n<blockquote>\n<p>SUBLIME_HOME=&quot;$HOME/APP/SublimeText2&quot;<br>\nLD_LIB=&quot;$SUBLIME_HOME/libsublime-imfix.so&quot;<br>\nsh  -c &quot;LD_PRELOAD=$LD_LIB  $SUBLIME_HOME/sublime_text $@&quot;</p>\n</blockquote>\n<p>当然，你也可以把SublimeText的desktop文件的Exce路径改成这个脚本文件的路径，然后就可以通过启动器启动软件了。</p>\n<p></p>\n<!--kg-card-end: markdown-->","date":"22 June 2014","path":"the-solution-of-the-problem-under-ubuntu-sublimetext-input-chinese"}},"context":{}}