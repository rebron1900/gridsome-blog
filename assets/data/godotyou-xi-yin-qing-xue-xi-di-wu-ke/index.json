{"hash":"2cbfaa773c414da5c97e6a0cf2cb9fa9d7db58ae","data":{"metadata":{"siteName":"只是玩玩 | JUST FUN","siteDescription":"Hello"},"post":{"id":"63158312cf533d1c2cf29b3a","title":"Godot游戏引擎学习 第五课","content":"<!--kg-card-begin: markdown--><h2 id>可移动平台</h2>\n<p>今天终于开始做场景了，万丈高楼平地起，先跟着视频做一个可移动平台。</p>\n<p>因为这种平台时可以复用的，所以我们基于Godot的引擎的对象思想在一个新的场景里构建移动平台，再实例化到主场景里，这样我们以后可以在其他场景里很方便的复用它。</p>\n<ol>\n<li>新建一个场景，并添加一个<code>Node2D</code>父节点名为<code>MovingPlatform</code></li>\n<li>因为平台时有碰撞体，所以在父节点下添加一个<code>KinematicBody2D</code>节点，并开启<code>Motion &gt; Sync To Physic</code>，物理计算和帧同步，避免出现延迟，人物悬浮在空中的情况。</li>\n<li>然后在<code>KinematicBody2D</code>下添加<code>Sprite</code>节点拖入平台的图片素材</li>\n<li>增加<code>CollisionShape2D</code>碰撞区域节点，并调整大小覆盖整个平台。<br>\n<img src=\"https://cdn.1900.live/typora/image-20201223201837307.png\" alt=\"image-20201223201837307\" loading=\"lazy\"></li>\n</ol>\n<p>平台算是添加好了，今天终于要使用新的节点了：<code>Path2D</code>和<code>PathFollow2D</code>，官方的文档里的解释：<code>Contains a Curve2D path for PathFollow2D nodes to follow.</code>，它可以在场景里绘制一个用于移动的曲线路径。不过这只是修好马路，我们还需要<code>RemoteTransform2D</code>这个节点可以指定一个节点对象更新它的<code>position, rotation and/or scale.</code>。对了，因为我们只想让平台上下移动，所以我们关掉<code>PathFollow2D</code>里的<code>Rotate</code>和<code>Loop</code></p>\n<p><img src=\"https://cdn.1900.live/typora/image-20201223204558512.png\" alt=\"image-20201223204558512\" loading=\"lazy\"></p>\n<p>好了，我们现在有了车辆，有了马路，也加好油了，现在需要用老朋友<code>AnimationPlayer</code>来让画面动起来了。</p>\n<ol>\n<li>在<code>AnimationPlayer</code>里新建一个<code>default</code>动画，长度设为4秒</li>\n<li>为<code>PathFollow2D</code>的<code>unit_offset</code>添加一个起始关键帧，并设为0</li>\n<li>并在第2秒插入第二个关键帧，把<code>uni_offset</code>设置为最大值，这样平台移动到一半的时候到达顶点，并在剩下的零秒重新归为最最小值。</li>\n</ol>\n<p>然后保存场景，并在<code>world</code>主场景中实例化平台，运行游戏，就能看到上下移动的平台了。</p>\n<p>然后是代码方面，现在存在一个问题，因为平台是有碰撞体的，如果角色站在平台下面会把角色压进地面里。而且在平台底下无法跳跃，所以做个改进。</p>\n<p>打开<code>CollisionShape2D</code>的<code>One Way Collis</code>，官方文档的解释是：<code>Sets whether this collision shape should only detect collision on one side (top or bottom).</code>，意思是只检测某一个方向的碰撞，就会像上图哪里平台会有个箭头指向下方。（默认是下方不检测碰撞，不知道怎么修改。）</p>\n<p>但是现在角色站在平台上会有一些抖动，所有跳跃的逻辑我们再修改一下，代码如下：</p>\n<pre><code class=\"language-python\"># 如果跳起来就是Vector2(0,0)下面那个函数再运算的时候就不会进行吸附\nvar snap = Vector2.ZERO if is_jumping else Vector2.DOWN * 16\n# move_and_slide_with_snap，跳跃后让角色吸附在平台上。\nvelocity = move_and_slide_with_snap(velocity, snap, Vector2.UP)\n</code></pre>\n<p>但是我这里角色还是有一些抖动，我代码应该是写对了的。</p>\n<p>另外有个没说了，我们可以通过Ctrl+d在主场景复制多个平台实例，但是会发现一个问题，我们选中任意一个平台节点右键选择子节点可编辑（比如这个平台我们想重新绘制移动路径，让平台斜着走），编辑其中内容后会发现其他所有的实例化的平台对象全都跟着变化了，我以前学过C#，对这个还算是了解，其实这些复制的所有节点都引用的同一个实例，像是投影出来的画面一样，你改了任意内容投影出来的其他画面也会耕者变化。所以我们可以把想单独修改的实例资源独立化，在属性界面点击这个小扳手，选择转为独立资源即可。：</p>\n<p><img src=\"https://cdn.1900.live/typora/image-20201223212146433.png\" alt=\"image-20201223212146433\" loading=\"lazy\"></p>\n<p>到这里算是完成了移动平台的实现。</p>\n<p>因为时间还多，这里我就跟着看了后面的一集课程，这集课很简单的，UP主说了一个BUG，就是因为我们在实现吃金币那里并没有去判断谁能迟到金币，所以现在情况是只要是金币被碰撞，不管碰撞它的是谁，都能把金币吃掉。</p>\n<p>所以UP解释了一个在游戏里层的概念。</p>\n<p>用过PS或者CDR的朋友应该知道，一个画面是可以被另外一个画面遮盖住，但是这个在这些软件中不存在同一层的情况 ，只有我遮住你了，或者你遮住我了。不过在Godot里碰撞就是分层的，在同一层的东西才能互相交互。</p>\n<p>我们打开金币场景，并选择父节点<code>Area2D</code>，可以在属性的Collision的子项里发现<code>Layer</code>和<code>Mask</code>，翻译过来就是画布层和遮罩层。</p>\n<p><img src=\"https://cdn.1900.live/typora/image-20201223213223599.png\" alt=\"image-20201223213223599\" loading=\"lazy\"></p>\n<p>这些小方块就是代表当前这个节点在碰撞层里所处的位置，当两个层的点有交集时就能互相碰撞。</p>\n<p>这些层的名字默认都是Layer1,Layer2这样的命名，为了方便管理我们可以在项目管理里修改这些层的名字</p>\n<p><img src=\"https://cdn.1900.live/typora/image-20201223214251289.png\" alt=\"image-20201223214251289\" loading=\"lazy\"></p>\n<p>好了，最终如下：</p>\n<p><img src=\"https://cdn.1900.live/typora/%E7%AC%AC%E4%BA%94%E8%AF%BE.gif\" alt=\"第五课\" loading=\"lazy\"></p>\n<!--kg-card-end: markdown-->","date":"23 December 2020","path":"godotyou-xi-yin-qing-xue-xi-di-wu-ke"}},"context":{}}