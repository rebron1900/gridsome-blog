{"hash":"09771c91682eedafd3ee73b22826856fd274f766","data":{"metadata":{"siteName":"只是玩玩 | JUST FUN","siteDescription":"Hello"},"post":{"id":"631c110d3236fa0a46811299","title":"用emoji-mart替换twikoo的emoji选择器","content":"<h3 id=\"%E5%89%8D%E8%A8%80\">前言</h3><p>我用twikoo也有好几年了，说实话从idisqus换过来后使用起来的感觉是非常舒适的，后来也试过valin(好像是这个名字)之类的其他自建评论工具，但是使用起来觉得没有twikoo舒服，还是很推荐这个评论工具的。</p><p>但是，twikoo的表情工具说实话是有些简陋的，虽然可以自定义Emotion.json来丰富可用的表情列表。但是界面不美观，可选择范围始终太窄，所以今天折腾一下它。</p><h3 id=\"emoji-mart\">emoji-mart</h3><figure class=\"kg-card kg-bookmark-card\"><a class=\"kg-bookmark-container\" href=\"https://github.com/missive/emoji-mart?ref=1900.live#-internationalization\"><div class=\"kg-bookmark-content\"><div class=\"kg-bookmark-title\">GitHub - missive/emoji-mart: 🏪 One component to pick them all</div><div class=\"kg-bookmark-description\">🏪 One component to pick them all. Contribute to missive/emoji-mart development by creating an account on GitHub.</div><div class=\"kg-bookmark-metadata\"><img class=\"kg-bookmark-icon\" src=\"https://github.com/fluidicon.png\" alt><span class=\"kg-bookmark-author\">GitHub</span><span class=\"kg-bookmark-publisher\">missive</span></div></div><div class=\"kg-bookmark-thumbnail\"><img src=\"https://repository-images.githubusercontent.com/63091815/e0e2b113-1c2c-4dd9-b12b-ab8111d68c9d\" alt></div></a></figure><p>emoji-mart是github上开源的一个emoji前端组件，基本上和现在手机上输入法使用的emoji功能一致，而且提供的emoji图标更为丰富，包含以下特性</p><ul><li>多平台emoji源：Native、apple、facebook、google、twitter..</li><li>light和dark主题颜色</li><li>和指定任意版本emoji</li><li>本地化（有中文，但是我上传到服务上后又不显示中文了...）</li><li>多肤色</li><li>可以快捷搜索emoji</li><li>等等..</li></ul><p>总的来说是一款相当优秀的开源工具，但是无法动态更改主题颜色（可能是我的使用方式不对，希望有大佬指证），也有外国人吐槽过这个组件，那个人还另外写了另外一个工具：<a href=\"https://github.com/nolanlawson/emoji-picker-element?ref=1900.live\">emoji-picker-element</a> 。</p><h3 id=\"%E5%A6%82%E4%BD%95%E9%9B%86%E6%88%90%E5%88%B0twikoo\">如何集成到twikoo</h3><p>利用twikoo的init的回调事件 <code>onCommentLoaded</code> 我们可以在评论加载完成后开始集成emoji-mart。</p><div class=\"kg-card kg-callout-card kg-callout-card-grey\"><div class=\"kg-callout-emoji\">💡</div><div class=\"kg-callout-text\">注意：twikoo的onCommentLoaded其实twikoo并没有完全加载完毕，经过我的测试twikoo原生的表情功能是在这个事件结束后才开始调用的，所以这里要 <code>关闭掉twikoo的原生表情功能</code>&nbsp;</div></div><figure class=\"kg-card kg-code-card\"><pre><code class=\"language-html\">&lt;script type=\"text/javascript\" src=\"https://cdn.jsdelivr.net/npm/emoji-mart@latest/dist/browser.js\"&gt;</code></pre><figcaption>引入emoji-mart库</figcaption></figure><figure class=\"kg-card kg-code-card\"><pre><code class=\"language-html\">&lt;div id=\"tcomment\"&gt;&lt;/div&gt;\n&lt;script&gt;twikoo.init({ \n\tenvId: '{{@custom.disqus_shortname}}', \n\tel: '#tcomment',\n\tonCommentLoaded: function () {\n\t\t\tconsole.log('评论加载完成');\n\n\t\t\t//初始化自定义emojimart\n\t\t\tconst pickerOptions = { \n\t\t\t\tonEmojiSelect: function(d){ $('.el-textarea__inner').val($('.el-textarea__inner').val() + d.native)  },\n\t\t\t\tlocale: 'zh',theme : 'dark'\n\t\t\t}\n\t\t\tconst picker = new EmojiMart.Picker(pickerOptions)\n            //把html注入网页内\n\t\t\t$('.tk-row-actions-start').append(picker)\n        \t//因为div默认不能使用focus事件，加上tabindex才可以\n\t\t\t$('em-emoji-picker').attr('tabindex','5')\n\t\t\t$('.OwO').show().click(function(){\n\t\t\t\t$('em-emoji-picker').toggle()\n\t\t\t\t$('em-emoji-picker').focus()\n\t\t\t})\n\t\t\t$('em-emoji-picker').blur(function(){\n\t\t\t\t$('em-emoji-picker').toggle()\n\t\t\t})\n\t\t\t\n\t\t}\n\t})\n\t\n&lt;/script&gt;</code></pre><figcaption>进行初始化</figcaption></figure><figure class=\"kg-card kg-code-card\"><pre><code class=\"language-css\">em-emoji-picker{\n    display: none;\n    position: absolute;\n    top: 3rem;\n    z-index: 2;\n}</code></pre><figcaption>增加一点简单的样式处理</figcaption></figure><figure class=\"kg-card kg-image-card kg-card-hascaption\"><img src=\"https://cdn.1900.live/assets/2022/09/10image.png\" class=\"kg-image\" alt loading=\"lazy\" width=\"966\" height=\"867\"><figcaption>效果图</figcaption></figure><h3 id=\"%E5%BE%85%E5%AE%8C%E5%96%84\">待完善</h3><p>因为目前的emoji-mart没办法动态改变主题，所以目前暂时还没有实现主题的联动，希望作者后续能进行改进。</p><h3 id=\"%E5%8F%82%E8%80%83%E9%93%BE%E6%8E%A5\">参考链接</h3><ul><li>div失去焦点事件 - <a href=\"https://blog.csdn.net/vip545058/article/details/24296865?ref=1900.live\">https://blog.csdn.net/vip545058/article/details/24296865</a></li></ul>","date":"10 September 2022","path":"replace-twikoos-emoji-selector-with-emoji-mart"}},"context":{}}