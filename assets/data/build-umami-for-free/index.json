{"hash":"79ad4906a93b028ce0cc44a61d77049cbbf31c8d","data":{"metadata":{"siteName":"只是玩玩 | JUST FUN","siteDescription":"Hello"},"post":{"id":"63158312cf533d1c2cf29b84","title":"免费搭建Umami作为博客网站统计服务","content":"<p>关于网站访问统计我用过很多服务，如：Google统计、51.la、百度统计等，其中51.la的使用时间是最长的。 但是这几个服务都存在几个问题</p><ul><li>界面太丑，这是原罪</li><li>存在广告问题</li><li>隐私问题，我的数据可能会被盗用、贩卖等。</li><li>容易被浏览者的uBlock等插件屏蔽</li></ul><p>鉴于这些问题我打算自己搭建一个轻量的博客网站统计服务，之前也有在Github上看过Plausible这个项目，但是当时折腾了好几天一直没部署成功所以就不了了之了。</p><p>今天在逛V2ex时偶然发现了一个<a href=\"https://github.com/umami-software/umami?ref=1900.live\">Umami</a>这个项目介绍以及免费的部署方式的<a href=\"https://www.v2ex.com/t/854146?ref=1900.live\">帖子</a> ，其中作者讲到如何利用Railway这个PaaS平台的免费额度部署Umami，我好像一下子就找到了我心目中完美的它了，毕竟谁不爱能白嫖又好用的工具呢？</p><div class=\"kg-card kg-callout-card kg-callout-card-blue\"><div class=\"kg-callout-emoji\">📊</div><div class=\"kg-callout-text\">Umami一款简单、易用、美观、轻量、快速、隐私安全，主要用于替代Google Analytics的开源免费网站统计工具。<br><br>Github：<a href=\"https://github.com/umami-software/umami?ref=1900.live\">https://github.com/umami-software/umami</a></div></div><figure class=\"kg-card kg-gallery-card kg-width-wide\"><div class=\"kg-gallery-container\"><div class=\"kg-gallery-row\"><div class=\"kg-gallery-image\"><img src=\"https://cdn.1900.live/202207/snipaste_2022-07-09_19-43-44.png\" width=\"2526\" height=\"1266\" loading=\"lazy\" alt></div><div class=\"kg-gallery-image\"><img src=\"https://cdn.1900.live/202207/snipaste_2022-07-09_19-44-37.png\" width=\"2516\" height=\"1251\" loading=\"lazy\" alt></div></div><div class=\"kg-gallery-row\"><div class=\"kg-gallery-image\"><img src=\"https://cdn.1900.live/202207/snipaste_2022-07-09_19-44-07.png\" width=\"2519\" height=\"1255\" loading=\"lazy\" alt></div><div class=\"kg-gallery-image\"><img src=\"https://cdn.1900.live/202207/snipaste_2022-07-09_19-44-47.png\" width=\"2521\" height=\"1263\" loading=\"lazy\" alt></div></div></div></figure><p>但是我在根据教程操作时遇到了些问题了。</p><p>我起初根据帖子的步骤进行操作，在Railway上创建项目都没有什么问题，基本上点点就可以了，但是到本地操作时发现需要进行一些命令行的操作，由于作者使用的是Mac平台，执行的命令和Windows上略微有些不一致，所以我试着看了下Railway的文档用Windows的命令替代，但是失败了，后来折腾了好几个小时一直弄不好。</p><p>后来试着直接点开网址——发现可以直接进去？后续的配置原来只需在网页上进行操作即可...，完全不用折腾什么命令行。</p><p>在这里也记录一下我部署的整个流程。</p><h3 id=\"%E5%88%9B%E5%BB%BA%E5%AE%9E%E4%BE%8B\">创建实例</h3><p>先注册Railway账号，希望你能通过的邀请链接注册。</p><div class=\"kg-card kg-callout-card kg-callout-card-yellow\"><div class=\"kg-callout-emoji\">🌍</div><div class=\"kg-callout-text\"><a href=\"https://railway.app/?referralCode=CVGa86&ref=1900.live\">https://railway.app?referralCode=CVGa86</a></div></div><p>然后我们打开<a href=\"https://umami.is/docs/running-on-railway?ref=1900.live\">Umami官方的Railway部署文档</a>，里面有一个紫色的 <code>Deploy on Railway</code> 的按钮，点击后会跳转到Railway，如果你上一步已经注册好并登录完成，这里会直接出现项目创建界面。</p><p>当然你也可以选择注册一个新账号或者使用Github账号登陆（推荐使用Github账号登陆，可以联动repo直接安装Umami，可能需要你授权账号权限）</p><p>之后会提示你进行项目命名，并填写一个 <code>HASH_SALT</code> （填写一串随机自赋，你可以通过快捷键ctrl+k，搜索Gen 找到Railway提供的生成器生成字符串），不过我不知道这个字符串是干什么用的？</p><p>点击确认后便会自动进行实例配置，直到出现图2的样子后点击系统自动生成的域名应该就可以访问Umami了，默认的账号 <code>admin</code> ，默认的密码 <code>umami</code> 。</p><p>登陆后请第一时间修改一个强壮的密码，并添加网站，然后就能获得统计代码了。和其他的统计服务一样，把代码嵌入网站即可，这些我就不解释了，自己进控制面板研究一下即可。</p><p>到目前为止Umami已经是可以使用了，其实就这么简单，不知道为什么V2ex上的额老哥说还要在本地进行操作？不知道这样操作有没有啥副作用？</p><figure class=\"kg-card kg-gallery-card kg-width-wide\"><div class=\"kg-gallery-container\"><div class=\"kg-gallery-row\"><div class=\"kg-gallery-image\"><img src=\"https://cdn.1900.live/202207/snipaste_2022-07-09_19-50-45.png\" width=\"1052\" height=\"1217\" loading=\"lazy\" alt></div><div class=\"kg-gallery-image\"><img src=\"https://cdn.1900.live/202207/snipaste_2022-07-09_19-54-14.png\" width=\"2533\" height=\"1246\" loading=\"lazy\" alt></div></div></div></figure><hr><h3 id=\"%E4%B8%80%E4%BA%9B%E5%85%B6%E4%BB%96%E9%85%8D%E7%BD%AE\">一些其他配置</h3><h4 id=\"%E7%BB%91%E5%AE%9A%E5%9F%9F%E5%90%8D\">绑定域名</h4><p>点击Github图标的umami，进入 <code>Settings</code> 点击 <code>Add Custom Domain</code> ，输入需要绑定的域名。</p><p>将Railway提供的CName值填入你的域名解析服务即可，等待解析生效即可。</p><figure class=\"kg-card kg-image-card kg-width-wide\"><img src=\"https://cdn.1900.live/202207/snipaste_2022-07-09_20-03-26.png\" class=\"kg-image\" alt loading=\"lazy\" width=\"2293\" height=\"1132\"></figure><h4 id=\"%E9%98%B2%E5%B1%8F%E8%94%BD\">防屏蔽</h4><p>Umami可以通过设置<code>TRACKER_SCRIPT_NAME</code> 这个字段更改最终引用的js名称，避免因为被uBlock等插件通过关键字匹配到进而被屏蔽的情况。</p><p>点击 <code>Variables</code> 进入变量设置界面，再点击 <code>New Variable</code> 添加变量，输入变量名称 <code>TRACKER_SCRIPT_NAME</code> ，Value设置为一个不容易被匹配到的名字。</p><p>最后去获取网站代码，将代码中的 <code>umami.js</code> 中的 <code>umami</code> 更改成你设置的 <code>TRACKER_SCRIPT_NAME</code> 值即可。如我设置的是 <code>test</code>，则改成 <code>test.js</code> 即可。</p><pre><code class=\"language-html\">&lt;script async defer data-website-id=\"a749d302-00ed-416c-bead-e5b5be397cf7\" src=\"https://test.1900.live/test.js\"&gt;&lt;/script&gt;</code></pre><figure class=\"kg-card kg-image-card kg-width-wide\"><img src=\"https://cdn.1900.live/202207/snipaste_2022-07-09_20-23-06.png\" class=\"kg-image\" alt loading=\"lazy\" width=\"2542\" height=\"1249\"></figure><hr><p>至此你应该已经拥有一个属于你自己的统计服务了，而且你还可以通过再后台新增账户分享给你的小伙伴一起使用，不过Railway每个月的免费额度只有5刀，我就不进行共享了~</p><p>希望对你们有用。</p>","date":"9 July 2022","path":"build-umami-for-free"}},"context":{}}