{"hash":"09771c91682eedafd3ee73b22826856fd274f766","data":{"metadata":{"siteName":"只是玩玩 | JUST FUN","siteDescription":"Hello"},"post":{"id":"63158312cf533d1c2cf29afd","title":"Ghost博客搜索功能","content":"<p>昨天下午闲来无事去Ghost的主题市场逛了圈，本来想着看看能不能找个好点的文字主题扒来用，无意间看到了<strong><a href=\"https://purus.golem.io/?ref=1900.live\">https://purus.golem.io</a></strong> 这个主题对于Ghost搜索功能的实现，作者采用采用的推特的<a href=\"https://github.com/twitter/typeahead.js?ref=1900.live\"><strong>typeahead.js</strong></a><strong> </strong>实现了Ghost博客系统里的搜索功能，不同于之间我某篇文章里提到的<a href=\"https://github.com/jamalneufeld/ghostHunter?ref=1900.live\"><strong>ghostHunter</strong></a>，只能对Rss里的文章进行搜索。</p><p>作者的做法是直接预读取所有文章的title+slug，然后配合<a href=\"https://github.com/twitter/typeahead.js/blob/master/doc/bloodhound.md?ref=1900.live\"><strong>Bloodhound</strong></a><strong> </strong>做数据分析(不知道能不能加全文搜索，有懂的大佬后续研究完可以交流一下)。不知道这样会不会影响网站加载效率，不知道有没有数据缓存的功能，英文苦手就不去研究了。</p><figure class=\"kg-card kg-image-card\"><img src=\"https://cdn.1900.live/20190315/timjie-tu-20190305130928.png\" class=\"kg-image\" alt loading=\"lazy\"></figure><p>手册说的不清楚我也看不懂，不怎么好diy，索性就直接把他的所有代码全部拿来用了，基本上没啥变动，各位根据自己博客的情况自行修改吧...。<em><strong>(能力有限，不提供后续解答，任何问题请自行解决)</strong></em></p><h3 id=\"-typeahead-jquery-\">先引入typeahead库，这个貌似要搭配jquery哈，注意引入顺序 </h3><!--kg-card-begin: markdown--><pre><code>&lt;script type=&quot;text/javascript&quot; src=&quot;https://cdnjs.cloudflare.com/ajax/libs/typeahead.js/0.11.1/typeahead.bundle.min.js&amp;#10;&quot;&gt;&lt;/script&gt;\n</code></pre>\n<!--kg-card-end: markdown--><h3 id=\"-head-code-\">在后的head code里添加</h3><!--kg-card-begin: markdown--><pre><code>&lt;script&gt;\n            //Wait for other things to be loaded so the site doesn't wait on the search\n            $(document).ready(function() {\n                //Go grab all the posts on the blog, but only the slug and title fields\n                //That helps limit the amount of data sent and stored locally\n                $.get(ghost.url.api('posts', {limit: &quot;all&quot;, fields: &quot;slug,title&quot;})).done(function(data) {\n                    //add all the data returned to a variable\n                    var searchData = data.posts; \n\n                    //New bloodhound to make it searchable\n                    var search = new Bloodhound({\n                      datumTokenizer: Bloodhound.tokenizers.obj.whitespace('title'),\n                      queryTokenizer: Bloodhound.tokenizers.whitespace,\n                      local: searchData\n                    });\n\n                    //Build the typeahead\n                    $('#site-search .typeahead').typeahead(null, {\n                          name: 'search',\n                          //source is the bloodhound variable\n                          source: search,\n                          templates: {\n                            empty: [\n                                '&lt;div class=&quot;empty-message&quot;&gt;',\n                                'unable to find any post that match the current query',\n                                '&lt;/div&gt;'\n                            ].join('\\n'),\n                            suggestion: function(data) {\n                                return '&lt;a href=&quot;/' + data.slug + '&quot;&gt;&lt;h2&gt;' + data.title + '&lt;/h2&gt;&lt;/a&gt;';\n                            }\n                        }\n                    }); \n\n                    //Now show the search bar since getting data was successful\n                    $('#site-search').show();\n                }).fail(function() {\n                    //If the get request errors out, put an error in the console\n                    console.log(&quot;Error getting Ghost API Data&quot;);\n                });\n            });\n        &lt;/script&gt;\n</code></pre>\n<!--kg-card-end: markdown--><h3 id=\"-\">添加模版代码</h3><!--kg-card-begin: markdown--><pre><code>            &lt;div id=&quot;site-search&quot; style=&quot;background-image: url(&amp;quot;/assets/img/search.png?v=8efd075636&amp;quot;);&quot;&gt;\n                &lt;!--Hide this until getting data is successful--&gt;\n                &lt;span class=&quot;twitter-typeahead&quot; style=&quot;position: relative; display: inline-block;&quot;&gt;\n                    &lt;input class=&quot;typeahead tt-hint&quot; type=&quot;text&quot; readonly=&quot;&quot; autocomplete=&quot;off&quot; spellcheck=&quot;false&quot; tabindex=&quot;-1&quot; dir=&quot;ltr&quot;\n                        style=&quot;position: absolute; top: 0px; left: 0px; border-color: transparent; box-shadow: none; opacity: 1; background: none 0% 0% / auto repeat scroll padding-box border-box rgb(255, 255, 255);&quot;&gt;\n                    &lt;input id=&quot;search-field&quot; class=&quot;typeahead tt-input&quot; type=&quot;text&quot; placeholder=&quot;Search&quot; autocomplete=&quot;off&quot; spellcheck=&quot;false&quot;\n                        dir=&quot;auto&quot; style=&quot;position: relative; vertical-align: top; background-color: transparent;&quot;&gt;\n                    &lt;pre aria-hidden=&quot;true&quot; style=&quot;position: absolute; visibility: hidden; white-space: pre; font-family: &amp;quot;Open Sans&amp;quot;, sans-serif; font-size: 16px; font-style: normal; font-variant: normal; font-weight: 300; word-spacing: 0px; letter-spacing: 0px; text-indent: 0px; text-rendering: auto; text-transform: none;&quot;&gt;&lt;/pre&gt;\n                    &lt;div class=&quot;tt-menu&quot; style=&quot;position: absolute; top: 100%; left: 0px; z-index: 100; display: none;&quot;&gt;\n                        &lt;div class=&quot;tt-dataset tt-dataset-search&quot;&gt;&lt;/div&gt;\n                    &lt;/div&gt;\n                    &lt;button type=&quot;button&quot; class=&quot;-search-reset&quot; title=&quot;Close&quot;&gt;×&lt;/button&gt;\n                &lt;/span&gt;\n                \n            &lt;/div&gt;\n</code></pre>\n<!--kg-card-end: markdown--><h3 id=\"-css\">再添加css</h3><!--kg-card-begin: markdown--><pre><code>/* Search results */\n#site-search .tt-menu {\n    display: block !important;\n    margin: 4rem auto;\n    padding: 1rem 0;\n    width: 100%;\n    color: #999;\n    font-family: 'Open Sans', sans-serif;\n    font-size: 1.4rem;\n    text-transform: uppercase;\n    letter-spacing: 0.02rem;\n    text-align: center;\n}\n\n#site-search .tt-menu a {\n    display: block;\n    width: 100%;\n    max-height: 90px;\n    text-align: center;\n    background: #f0f0f0;\n    border-radius: 20px;\n    margin: 2rem 0;\n    color: #333;\n    padding: 0 0 2.5rem;\n}\n\n#site-search .tt-menu a:last-child { margin-bottom: 8rem;}\n\n#site-search .tt-menu a h2 {\n    font-size: 2.2rem;\n    font-weight: 300;\n    padding: 3.2rem 2rem 1rem;\n    margin: 0;\n    white-space: nowrap;\n    overflow: hidden;\n    text-overflow: ellipsis;\n    text-transform: lowercase;\n}\n\n#site-search .tt-menu a h2:first-letter { text-transform: capitalize; }\n\n#site-search .tt-menu a:hover {\n    background: #ff5722;\n    color: #fff;\n}\n</code></pre>\n<!--kg-card-end: markdown-->","date":"5 March 2019","path":"ghostbo-ke-sou-suo-gong-neng"}},"context":{}}