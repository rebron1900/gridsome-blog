{"hash":"0810a28e7848218696784bc8b33ad1e40c9e72dc","data":{"metadata":{"siteName":"只是玩玩 | JUST FUN","siteDescription":"Hello"},"post":{"id":"63158312cf533d1c2cf29b39","title":"Godot游戏引擎学习 第四课","content":"<!--kg-card-begin: markdown--><p>今天UP主的这节课没什么内容，主要时优化了跳跃和移动，本来像提前看UP主的下一个视频：在场景中增加移动的砖块，但是因为一些事情耽搁，这篇文章写完的时候已经快11点钟了，自己也有点累了，今天就学到这里把。</p>\n<h2 id>优化移动和跳跃</h2>\n<p>目前角色的移动方式是按下就走，放开按键就立马停止，像个机器人。我们可以利用<code>move_toward()</code>函数实现一个加速效果，这样角色在移动和停止的时候会有一个加速和减速效果。</p>\n<pre><code class=\"language-python\"># 如果在地上则给与地面加速度，如果在空中则给与空中加速度，这是要给GDScript中的三元表达式，if后面的表达式如果为真则将前面的额值给acc，否则给后面的值\nvar acc = acceleration if is_on_floor() else air_acceleration\n# move_toward 利用delta值从a值到b值进行增量增长，到达max_speed\nvelocity.x = move_toward(velocity.x, direction * max_speed, acc * delta)\n</code></pre>\n<p>跳跃的更改了大部分以前的跳跃逻辑，之前的角色在平台上跳跃出去后在空中还可以进行一次二段跳，这有点不符合逻辑，所以这里更改了跳跃逻辑。</p>\n<p>首先解决从平台上跳跃出去后还可以在空中跳跃一次的问题。增了一个主要状态变量<code>can_jump</code>，因为代码很琐碎，等会直接把代码贴上来把。我在这里说下主体思路把。</p>\n<p>首先跳跃不能仅仅判断角色是否处于跳跃状态了，还得判断是否在地板上，如果是刚刚刚离开地面一定时间内允许跳跃，超过了则不允许。所以这里要用要新的节点组件<code>Timer</code>，这个就时一个计时器，可以控制多少时间内计时一次。让角色在离开里面时便开始计时，如果在指定时间内则允许继续跳跃（课件作者这个好像有点不严谨，如果在地面上跳跃不是会有一个很短的2连跳？）</p>\n<p>且怎加了一个小跳功能，如果在跳跃状态松开了跳跃按钮，且跳跃高度低于设定的小跳高度则变为小跳。</p>\n<p>另外增加角色的快要落地时玩家想立马起跳的判断，之前时角色必须完全落地时才能进行跳跃。</p>\n<p>修改后的相关代码如下：</p>\n<pre><code class=\"language-python\">extends KinematicBody2D\n\n# 设置人物重力\nconst gravity = 2000 \n# 设置人物移动速度\nconst max_speed = 350\n# 地面的加速度和空中的加速度\nconst acceleration = max_speed / 0.2\nconst air_acceleration = max_speed / 0.05\n# 设置人物跳跃高度\nconst jump_force = 800\n\n\n# 速度\nvar velocity = Vector2.ZERO\n# 是否处于跳跃状态\nvar is_jumping = false\n# 人物方向\nvar direction\n\n# 在Godot可以通过$符号获取当前目录的所有节点，onready表示只要游戏一准备好就首先把节点取出来存到变量中\nonready var animation_palyer = $AnimationPlayer\nonready var sprite = $Sprite\n# 获取两个计时器的节点对象\nonready var coyote_timer = $CoyoteTimer\nonready var jump_request_timer = $JumpRequestTimer\n\n# 物理帧处理，delta参数忘记是啥意思了，好像是同步画面的。\nfunc _physics_process(_delta):\n\t# 在每一帧判断角色是否在地板之上\n\tvar was_on_floor = is_on_floor()\n\n\t# move_and_slide为父类函数，用于sprite移动，第二个参数指定天花板是那个方向\n\tvelocity = move_and_slide(velocity, Vector2.UP)\n\t# is_on_floor父类函数，如果主体在地板上，则返回true。仅在调用move_and_slide（）时更新。\n\tif is_on_floor():\n\t\t# 如果人物在地板上则允许进行跳操作\n\t\tis_jumping = false\n\t# 如果在地板上，且是允许跳跃状态才进行跳跃\n\telif was_on_floor and not is_jumping:\n\t\t# 在跳跃的瞬间开其计时器\n\t\tcoyote_timer.start()\n\t#sprite.flip_h = direction\n\n# 检测玩家输入（这个函数只在玩家有按下按键时才进行调用）\nfunc _input(event):\n\t# 实现落地的瞬间跳跃功能，开启计时器\n\tif event.is_action_pressed(&quot;move_jump&quot;):\n\t\tjump_request_timer.start()\n\t# 通过event.is_action_released判断是否在起跳过程中释放了空格键，并且跳跃高度没有超过小跳高度则进行小跳。\n\tif event.is_action_released(&quot;move_jump&quot;) and velocity.y &lt; -jump_force / 2:\n\t\tvelocity.y = -jump_force / 2\n\t\n\t\n\n# 每一帧都会执行这个函数\nfunc _process(delta):\n\t# 检测用户按钮，get_action_strength返回按下状态，按下为1，没按则0，如果按下right则返回复数，按下left返回正数\n\tdirection = Input.get_action_strength(&quot;move_right&quot;) - Input.get_action_strength(&quot;move_left&quot;)\n\t# 如果在地上则给与地面加速度，如果在空中则给与空中加速度，这是要给GDScript中的三元表达式，if后面的表达式如果为真则将前面的额值给acc，否则给后面的值\n\tvar acc = acceleration if is_on_floor() else air_acceleration\n\n\t# 利用获取到的方向值进行人物左右移动。\n\t# move_toward 利用delta值让从a值到b值进行增量增长，到达max_speed\n\tvelocity.x = move_toward(velocity.x, direction * max_speed, acc * delta)\n\t# 跳跃\n\tvelocity.y += gravity * delta\n\t\n\t# 新增状态变量can_jump ，如果在地上，或者coyote_timer小于0.2则允许跳跃\n\tvar can_jump = is_on_floor() or coyote_timer.time_left &lt; 0\n\t# 如果允许跳跃（在地上或者处于coyote时间内）或者同时处于落地瞬间，则可触犯跳状态则让精灵腾空\n\tif can_jump and jump_request_timer.time_left &gt; 0:\n\t\tvelocity.y = -jump_force\n\t\t# 设置跳跃状态，避免可以进行连跳操作\n\t\tis_jumping = true\n\t\t# 避免bug，关闭掉两个计时器\n\t\tjump_request_timer.stop()\n\t\tcoyote_timer.stop()\n\t\n\t# 控制sprite动画\n\t# 如果处于可跳跃状态，则播放跳跃动画\n\tif is_jumping:\n\t\tanimation_palyer.play(&quot;jump&quot;)\n\t# 空闲状态播放空闲动画\n\telif velocity.x == 0:\n\t\tanimation_palyer.play(&quot;idle&quot;)\n\t# 移动状态则播放移动动画\n\telse:\n\t\tanimation_palyer.play(&quot;walk&quot;)\n\t\t\n\t# 根据移动方向更新角色朝向\n\tif direction != 0:\n\t\tsprite.flip_h = direction &lt; 0\n\t\n\n</code></pre>\n<p><img src=\"https://cdn.1900.live/typora/%E7%AC%AC%E5%9B%9B%E8%AF%BE.gif\" alt=\"第四课\" loading=\"lazy\"></p>\n<!--kg-card-end: markdown-->","date":"22 December 2020","path":"godotyou-xi-yin-qing-xue-xi-di-si-ke"}},"context":{}}